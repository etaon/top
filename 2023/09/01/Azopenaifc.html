<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>Azure OpenAI Function Calling 101 - 路无止境！</title><meta name=keywords content="博客,架构师,思考,读书,笔记,技术,分享,云"><meta name=author content="Etaon"><meta property="og:title" content="Azure OpenAI Function Calling 101"><meta property="og:site_name" content="路无止境！"><meta property="og:image" content="/img/author.jpg"><meta name=title content="Azure OpenAI Function Calling 101 - 路无止境！"><meta name=description content="欢迎来到ETAON空间站，个人主要专注于Infra系统架构，私有/公有云产品，售前及微服务解决方案。"><link rel="shortcut icon" href=/img/favicon.ico><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet><link href=/css/main.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><div class=multi-lang-switch><i class="fa fa-fw fa-language" style=margin-right:5px></i>
<a class=lang-link id=zh-cn href=#>学习</a></div><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>路无止境！</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>没有伞的孩子要学会努力奔跑!</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class=menu-item><a href=/404.html rel=section><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline" style=font-weight:700><a class=post-title-link href=https://www.etaon.top/2023/09/01/Azopenaifc.html itemprop=url>Azure OpenAI Function Calling 101</a></h1></header><div class=post-body itemprop=articleBody><h2 id=概述>概述</h2><p>本文是结合 github：OpenAI Function Calling 101在 Azure OpenAI 上的实现：
<a href=https://github.com/dkhundley/openai-api-tutorial/blob/main/notebooks/function-calling.ipynb>Github Function Calling 101</a></p><p><a href=https://learn.microsoft.com/zh-cn/azure/ai-services/openai/how-to/function-calling>如何将函数调用与 Azure OpenAI 服务配合使用 - Azure OpenAI Service</a></p><p>使用像ChatGPT这样的llm的困难之一是它们不产生结构化的数据输出。这对于在很大程度上依赖结构化数据进行系统交互的程序化系统非常重要。例如，如果你想构建一个程序来分析电影评论的情绪，你可能必须执行如下提示:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>prompt = f<span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>Please perform a sentiment analysis on the following movie review:
</span></span></span><span style=display:flex><span><span style=color:#b44>{MOVIE_REVIEW_TEXT}
</span></span></span><span style=display:flex><span><span style=color:#b44>Please output your response as a single word: either &#34;Positive&#34; or &#34;Negative&#34;. Do not add any extra characters.
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span></code></pre></div><p>这样做的问题是，它并不总是有效。法学硕士学位通常会加上一个不受欢迎的段落或更长的解释，比如:“这部电影的情感是:积极的。”</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>prompt = f<span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>Please perform a sentiment analysis on the following movie review:
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>{The Shawshank Redemption}
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>Please output your response as a single word: either &#34;Positive&#34; or &#34;Negative&#34;. Do not add any extra characters.
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#OpenAI Answer</span>
</span></span><span style=display:flex><span>import nltk
</span></span><span style=display:flex><span>from nltk.sentiment import SentimentIntensityAnalyzer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Define the movie review</span>
</span></span><span style=display:flex><span>movie_review = <span style=color:#b44>&#34;The Shawshank Redemption&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Perform sentiment analysis</span>
</span></span><span style=display:flex><span>sid = SentimentIntensityAnalyzer()
</span></span><span style=display:flex><span>sentiment_scores = sid.polarity_scores(movie_review)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Determine the sentiment based on the compound score</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> sentiment_scores[<span style=color:#b44>&#39;compound&#39;</span>] &gt;= 0<span>:</span>
</span></span><span style=display:flex><span>    sentiment = <span style=color:#b44>&#34;Positive&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>else</span><span>:</span>
</span></span><span style=display:flex><span>    sentiment = <span style=color:#b44>&#34;Negative&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Output the sentiment</span>
</span></span><span style=display:flex><span>sentiment
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>The sentiment analysis of the movie review <span style=color:#b44>&#34;The Shawshank Redemption&#34;</span> is <span style=color:#b44>&#34;Positive&#34;</span>.
</span></span></code></pre></div><p>虽然您可以通过正则表达式得到答案(🤢)，但这显然不是理想的。理想的情况是LLM将返回类似以下结构化JSON的输出:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;sentiment&#39;</span><span>:</span> <span style=color:#b44>&#39;positive&#39;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>进入OpenAI的新函数调用! 函数调用正是上述问题的答案。
本Jupyter笔记本将演示如何在Python中使用OpenAI的新函数调用的简单示例。如果你想看完整的文档，请点击这个链接<a href=https://platform.openai.com/docs/guides/gpt/function-calling>https://platform.openai.com/docs/guides/gpt/function-calling</a></p><h3 id=初始化配置>初始化配置</h3><p>安装openai Python客户端，已经安装的需要升级它以获得新的函数调用功能</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>pip3 install openai
</span></span><span style=display:flex><span>pip3 install openai --upgrade
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic># Importing the necessary Python libraries</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>import</span> <span style=color:#00f;font-weight:700>os</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>import</span> <span style=color:#00f;font-weight:700>json</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>import</span> <span style=color:#00f;font-weight:700>yaml</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>import</span> <span style=color:#00f;font-weight:700>openai</span>
</span></span></code></pre></div><p>结合Azure Openai 的内容，将 API 的设置按照 Azure 给的方式结合文件（放 key）,同时准备一个about-me.txt</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#../keys/openai-keys.yaml 
</span></span><span style=display:flex><span>API_KEY: 06332xxxxxxcd4e70bxxxxxx6ee135
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#../data/about-me.txt 
</span></span><span style=display:flex><span>Hello! My name is Enigma Zhao. I am an Azure cloud engineer at Microsoft. I enjoy learning about AI and teaching what I learn back to others. I have two sons and a daughter. I drive a Audi A3, and my favorite video game series is The Legend of Zelda.
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>openai<span style=color:#666>.</span>api_version <span style=color:#666>=</span> <span style=color:#b44>&#34;2023-07-01-preview&#34;</span>
</span></span><span style=display:flex><span>openai<span style=color:#666>.</span>api_type <span style=color:#666>=</span> <span style=color:#b44>&#34;azure&#34;</span>
</span></span><span style=display:flex><span>openai<span style=color:#666>.</span>api_base <span style=color:#666>=</span> <span style=color:#b44>&#34;https://aoaifr01.openai.azure.com/&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Loading the API key and organization ID from file (NOT pushed to GitHub)</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>with</span> <span style=color:#a2f>open</span>(<span style=color:#b44>&#39;../keys/openai-keys.yaml&#39;</span>) <span style=color:#a2f;font-weight:700>as</span> f:
</span></span><span style=display:flex><span>    keys_yaml <span style=color:#666>=</span> yaml<span style=color:#666>.</span>safe_load(f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Applying our API key</span>
</span></span><span style=display:flex><span>openai<span style=color:#666>.</span>api_key <span style=color:#666>=</span> keys_yaml[<span style=color:#b44>&#39;API_KEY&#39;</span>]
</span></span><span style=display:flex><span>os<span style=color:#666>.</span>environ[<span style=color:#b44>&#39;OPENAI_API_KEY&#39;</span>] <span style=color:#666>=</span> keys_yaml[<span style=color:#b44>&#39;API_KEY&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Loading the &#34;About Me&#34; text from local file</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>with</span> <span style=color:#a2f>open</span>(<span style=color:#b44>&#39;../data/about-me.txt&#39;</span>, <span style=color:#b44>&#39;r&#39;</span>) <span style=color:#a2f;font-weight:700>as</span> f:
</span></span><span style=display:flex><span>    about_me <span style=color:#666>=</span> f<span style=color:#666>.</span>read()
</span></span></code></pre></div><h3 id=测试json-转换>测试Json 转换</h3><p>在使用函数调用之前，先看一下如何使用提示工程和Regex生成一个结构JSON，在以后会使用到。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic># Engineering a prompt to extract as much information from &#34;About Me&#34; as a JSON object</span>
</span></span><span style=display:flex><span>about_me_prompt <span style=color:#666>=</span> <span style=color:#b44>f</span><span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>Please extract information as a JSON object. Please look for the following pieces of information.
</span></span></span><span style=display:flex><span><span style=color:#b44>Name
</span></span></span><span style=display:flex><span><span style=color:#b44>Job title
</span></span></span><span style=display:flex><span><span style=color:#b44>Company
</span></span></span><span style=display:flex><span><span style=color:#b44>Number of children as a single number
</span></span></span><span style=display:flex><span><span style=color:#b44>Car make
</span></span></span><span style=display:flex><span><span style=color:#b44>Car model
</span></span></span><span style=display:flex><span><span style=color:#b44>Favorite video game series
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>This is the body of text to extract the information from:
</span></span></span><span style=display:flex><span><span style=color:#b44></span><span style=color:#b68;font-weight:700>{</span>about_me<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Getting the response back from ChatGPT (gpt-4)</span>
</span></span><span style=display:flex><span>openai_response <span style=color:#666>=</span> openai<span style=color:#666>.</span>ChatCompletion<span style=color:#666>.</span>create(
</span></span><span style=display:flex><span>    engine<span style=color:#666>=</span><span style=color:#b44>&#34;gpt-4&#34;</span>,
</span></span><span style=display:flex><span>    messages <span style=color:#666>=</span> [{<span style=color:#b44>&#39;role&#39;</span>: <span style=color:#b44>&#39;user&#39;</span>, <span style=color:#b44>&#39;content&#39;</span>: about_me_prompt}]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Loading the response as a JSON object</span>
</span></span><span style=display:flex><span>json_response <span style=color:#666>=</span> json<span style=color:#666>.</span>loads(openai_response[<span style=color:#b44>&#39;choices&#39;</span>][<span style=color:#666>0</span>][<span style=color:#b44>&#39;message&#39;</span>][<span style=color:#b44>&#39;content&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(json_response)
</span></span></code></pre></div><p>输出如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@ubuntu0:~/python# python3 <span style=color:#666>[</span>fc1.py<span style=color:#666>](</span>http://fc1.py/<span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span><span style=color:#b44>&#39;Name&#39;</span>: <span style=color:#b44>&#39;Enigma Zhao&#39;</span>, <span style=color:#b44>&#39;Job title&#39;</span>: <span style=color:#b44>&#39;Azure cloud engineer&#39;</span>, <span style=color:#b44>&#39;Company&#39;</span>: <span style=color:#b44>&#39;Microsoft&#39;</span>, <span style=color:#b44>&#39;Number of children&#39;</span>: 3, <span style=color:#b44>&#39;Car make&#39;</span>: <span style=color:#b44>&#39;Audi&#39;</span>, <span style=color:#b44>&#39;Car model&#39;</span>: <span style=color:#b44>&#39;A3&#39;</span>, <span style=color:#b44>&#39;Favorite video game series&#39;</span>: <span style=color:#b44>&#39;The Legend of Zelda&#39;</span><span style=color:#666>}</span>
</span></span></code></pre></div><h3 id=简单的自定义函数>简单的自定义函数</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic># Defining our initial extract_person_info function</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>extract_person_info</span>(name, job_title, num_children):
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>    Prints basic &#34;About Me&#34; information
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>    Inputs:
</span></span></span><span style=display:flex><span><span style=color:#b44>        name (str): Name of the person
</span></span></span><span style=display:flex><span><span style=color:#b44>        job_title (str): Job title of the person
</span></span></span><span style=display:flex><span><span style=color:#b44>        num_chilren (int): The number of children the parent has.
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a2f>print</span>(<span style=color:#b44>f</span><span style=color:#b44>&#39;This person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s name is </span><span style=color:#b68;font-weight:700>{</span>name<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>. Their job title is </span><span style=color:#b68;font-weight:700>{</span>job_title<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>, and they have </span><span style=color:#b68;font-weight:700>{</span>num_children<span style=color:#b68;font-weight:700>}</span><span style=color:#b44> children.&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Defining how we want ChatGPT to call our custom functions</span>
</span></span><span style=display:flex><span>my_custom_functions <span style=color:#666>=</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;name&#39;</span>: <span style=color:#b44>&#39;extract_person_info&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Get &#34;About Me&#34; information from the body of the input text&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;parameters&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;object&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;properties&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;name&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Name of the person&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;job_title&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Job title of the person&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;num_children&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;integer&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Number of children the person is a parent to&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>openai_response <span style=color:#666>=</span> openai<span style=color:#666>.</span>ChatCompletion<span style=color:#666>.</span>create(
</span></span><span style=display:flex><span>    engine<span style=color:#666>=</span><span style=color:#b44>&#34;gpt-4&#34;</span>,
</span></span><span style=display:flex><span>    messages <span style=color:#666>=</span> [{<span style=color:#b44>&#39;role&#39;</span>: <span style=color:#b44>&#39;user&#39;</span>, <span style=color:#b44>&#39;content&#39;</span>: about_me}],
</span></span><span style=display:flex><span>    functions <span style=color:#666>=</span> my_custom_functions,
</span></span><span style=display:flex><span>    function_call <span style=color:#666>=</span> <span style=color:#b44>&#39;auto&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(openai_response)
</span></span></code></pre></div><p>输出如下,OpenAI 讲 about_me 的内容根据 function 的格式进行梳理，调用 function 输出：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>root<span style=color:#a2f>@ubuntu0</span>:<span style=color:#666>~/</span>python<span style=color:#080;font-style:italic># python3 fc2.py </span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;id&#34;</span>: <span style=color:#b44>&#34;chatcmpl-7tYiDoEjPpzNw3tPo3ZDFdaHSbS5u&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;object&#34;</span>: <span style=color:#b44>&#34;chat.completion&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;created&#34;</span>: <span style=color:#666>1693475829</span>,
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;model&#34;</span>: <span style=color:#b44>&#34;gpt-4&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;prompt_annotations&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;prompt_index&#34;</span>: <span style=color:#666>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;content_filter_results&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;hate&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;self_harm&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;sexual&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;violence&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;choices&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;index&#34;</span>: <span style=color:#666>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;finish_reason&#34;</span>: <span style=color:#b44>&#34;function_call&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;message&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;role&#34;</span>: <span style=color:#b44>&#34;assistant&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;function_call&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;name&#34;</span>: <span style=color:#b44>&#34;extract_person_info&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;arguments&#34;</span>: <span style=color:#b44>&#34;{</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>  </span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>name</span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>: </span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>Enigma Zhao</span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>,</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>  </span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>job_title</span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>: </span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>Azure cloud engineer</span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>,</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>  </span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>num_children</span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>: 3</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>}&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;content_filter_results&#34;</span>: {}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;usage&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;completion_tokens&#34;</span>: <span style=color:#666>36</span>,
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;prompt_tokens&#34;</span>: <span style=color:#666>147</span>,
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;total_tokens&#34;</span>: <span style=color:#666>183</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在上面的示例中，自定义函数提取三个非常具体的信息位，通过传递自定义的“About Me”文本作为提示符来证明这可以成功地工作。</p><p>如果传入任何其他不包含该信息的提示，会发生什么?</p><p>在API客户端调用function_call中设置了一个参数，并将其设置为auto。这个参数实际上是在告诉ChatGPT在确定何时为自定义函数构建输出时使用它的最佳判断。</p><p>所以，当提交的提示符与任何自定义函数都不匹配时，会发生什么呢?
简单地说，它默认为典型的行为，就好像函数调用不存在一样。
我们用一个任意的提示来测试一下:“埃菲尔铁塔有多高?”，修改如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>openai_response <span style=color:#666>=</span> openai<span style=color:#666>.</span>ChatCompletion<span style=color:#666>.</span>create(
</span></span><span style=display:flex><span>    engine<span style=color:#666>=</span><span style=color:#b44>&#34;gpt-4&#34;</span>,
</span></span><span style=display:flex><span>    messages <span style=color:#666>=</span> [{<span style=color:#b44>&#39;role&#39;</span>: <span style=color:#b44>&#39;user&#39;</span>, <span style=color:#b44>&#39;content&#39;</span>: <span style=color:#b44>&#39;How tall is the Eiffel Tower?&#39;</span>}],
</span></span><span style=display:flex><span>    functions <span style=color:#666>=</span> my_custom_functions,
</span></span><span style=display:flex><span>    function_call <span style=color:#666>=</span> <span style=color:#b44>&#39;auto&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(openai_response)
</span></span></code></pre></div><p>输出结果</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;id&#34;</span>: <span style=color:#b44>&#34;chatcmpl-7tYvdaiKaoiWW7NXz8QDeZZYEKnko&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;object&#34;</span>: <span style=color:#b44>&#34;chat.completion&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;created&#34;</span>: <span style=color:#666>1693476661</span>,
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;model&#34;</span>: <span style=color:#b44>&#34;gpt-4&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;prompt_annotations&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;prompt_index&#34;</span>: <span style=color:#666>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;content_filter_results&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;hate&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;self_harm&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;sexual&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;violence&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;choices&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;index&#34;</span>: <span style=color:#666>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;finish_reason&#34;</span>: <span style=color:#b44>&#34;stop&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;message&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;role&#34;</span>: <span style=color:#b44>&#34;assistant&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;content&#34;</span>: <span style=color:#b44>&#34;The Eiffel Tower is approximately 330 meters (1083 feet) tall.&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#b44>&#34;content_filter_results&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;hate&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;self_harm&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;sexual&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#34;violence&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span>          <span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;usage&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;completion_tokens&#34;</span>: <span style=color:#666>18</span>,
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;prompt_tokens&#34;</span>: <span style=color:#666>97</span>,
</span></span><span style=display:flex><span>    <span style=color:#b44>&#34;total_tokens&#34;</span>: <span style=color:#666>115</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=多样本情况>多样本情况</h3><p>现在让我们演示一下，当我们将3个不同的样本应用于所有自定义函数时会发生什么。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic># Defining a function to extract only vehicle information</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>extract_vehicle_info</span>(vehicle_make, vehicle_model):
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>    Prints basic vehicle information
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>    Inputs:
</span></span></span><span style=display:flex><span><span style=color:#b44>        - vehicle_make (str): Make of the vehicle
</span></span></span><span style=display:flex><span><span style=color:#b44>        - vehicle_model (str): Model of the vehicle
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a2f>print</span>(<span style=color:#b44>f</span><span style=color:#b44>&#39;Vehicle make: </span><span style=color:#b68;font-weight:700>{</span>vehicle_make<span style=color:#b68;font-weight:700>}</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>Vehicle model: </span><span style=color:#b68;font-weight:700>{</span>vehicle_model<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Defining a function to extract all information provided in the original &#34;About Me&#34; prompt</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>extract_all_info</span>(name, job_title, num_children, vehicle_make, vehicle_model, company_name, favorite_vg_series):
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>    Prints the full &#34;About Me&#34; information
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>    Inputs:
</span></span></span><span style=display:flex><span><span style=color:#b44>        - name (str): Name of the person
</span></span></span><span style=display:flex><span><span style=color:#b44>        - job_title (str): Job title of the person
</span></span></span><span style=display:flex><span><span style=color:#b44>        - num_chilren (int): The number of children the parent has
</span></span></span><span style=display:flex><span><span style=color:#b44>        - vehicle_make (str): Make of the vehicle
</span></span></span><span style=display:flex><span><span style=color:#b44>        - vehicle_model (str): Model of the vehicle
</span></span></span><span style=display:flex><span><span style=color:#b44>        - company_name (str): Name of the company the person works for
</span></span></span><span style=display:flex><span><span style=color:#b44>        - favorite_vg_series (str): Person&#39;s favorite video game series.
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a2f>print</span>(<span style=color:#b44>f</span><span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>    This person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s name is </span><span style=color:#b68;font-weight:700>{</span>name<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>. Their job title is </span><span style=color:#b68;font-weight:700>{</span>job_title<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>, and they have </span><span style=color:#b68;font-weight:700>{</span>num_children<span style=color:#b68;font-weight:700>}</span><span style=color:#b44> children.
</span></span></span><span style=display:flex><span><span style=color:#b44>    They drive a </span><span style=color:#b68;font-weight:700>{</span>vehicle_make<span style=color:#b68;font-weight:700>}</span><span style=color:#b44> </span><span style=color:#b68;font-weight:700>{</span>vehicle_model<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>.
</span></span></span><span style=display:flex><span><span style=color:#b44>    They work for </span><span style=color:#b68;font-weight:700>{</span>company_name<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>.
</span></span></span><span style=display:flex><span><span style=color:#b44>    Their favorite video game series is </span><span style=color:#b68;font-weight:700>{</span>favorite_vg_series<span style=color:#b68;font-weight:700>}</span><span style=color:#b44>.
</span></span></span><span style=display:flex><span><span style=color:#b44>    &#39;&#39;&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic># Defining how we want ChatGPT to call our custom functions</span>
</span></span><span style=display:flex><span>my_custom_functions <span style=color:#666>=</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;name&#39;</span>: <span style=color:#b44>&#39;extract_person_info&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Get &#34;About Me&#34; information from the body of the input text&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;parameters&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;object&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;properties&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;name&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Name of the person&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;job_title&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Job title of the person&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;num_children&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;integer&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Number of children the person is a parent to&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;name&#39;</span>: <span style=color:#b44>&#39;extract_vehicle_info&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Extract the make and model of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s car&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;parameters&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;object&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;properties&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;vehicle_make&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Make of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s vehicle&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;vehicle_model&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Model of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s vehicle&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;name&#39;</span>: <span style=color:#b44>&#39;extract_all_info&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Extract all information about a person including their vehicle make and model&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;parameters&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;object&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;properties&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;name&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Name of the person&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;job_title&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Job title of the person&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;num_children&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;integer&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Number of children the person is a parent to&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;vehicle_make&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Make of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s vehicle&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;vehicle_model&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Model of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s vehicle&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;company_name&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Name of the company the person works for&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#b44>&#39;favorite_vg_series&#39;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Name of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s favorite video game series&#39;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic># Defining a list of samples</span>
</span></span><span style=display:flex><span>samples <span style=color:#666>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#a2f>str</span>(about_me),
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;My name is David Hundley. I am a principal machine learning engineer, and I have two daughters.&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;She drives a Kia Sportage.&#39;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Iterating over the three samples</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>for</span> i, sample <span style=color:#a2f;font-weight:700>in</span> <span style=color:#a2f>enumerate</span>(samples):
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a2f>print</span>(<span style=color:#b44>f</span><span style=color:#b44>&#39;Sample #</span><span style=color:#b68;font-weight:700>{</span>i <span style=color:#666>+</span> <span style=color:#666>1</span><span style=color:#b68;font-weight:700>}</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s results:&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic># Getting the response back from ChatGPT (gpt-4)</span>
</span></span><span style=display:flex><span>    openai_response <span style=color:#666>=</span> openai<span style=color:#666>.</span>ChatCompletion<span style=color:#666>.</span>create(
</span></span><span style=display:flex><span>        engine <span style=color:#666>=</span> <span style=color:#b44>&#39;gpt-4&#39;</span>,
</span></span><span style=display:flex><span>        messages <span style=color:#666>=</span> [{<span style=color:#b44>&#39;role&#39;</span>: <span style=color:#b44>&#39;user&#39;</span>, <span style=color:#b44>&#39;content&#39;</span>: sample}],
</span></span><span style=display:flex><span>        functions <span style=color:#666>=</span> my_custom_functions,
</span></span><span style=display:flex><span>        function_call <span style=color:#666>=</span> <span style=color:#b44>&#39;auto&#39;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic># Printing the sample&#39;s response</span>
</span></span><span style=display:flex><span>    <span style=color:#a2f>print</span>(openai_response)
</span></span></code></pre></div><p>输出如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@ubuntu0:~/python# python3 <span style=color:#666>[</span>fc3.py<span style=color:#666>](</span>http://fc3.py/<span style=color:#666>)</span>
</span></span><span style=display:flex><span>Sample <span style=color:#080;font-style:italic>#1&#39;s results:</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;id&#34;</span>: <span style=color:#b44>&#34;chatcmpl-7tq3Nh7BSccfFAmT2psZcRR3hHpZ7&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;object&#34;</span>: <span style=color:#b44>&#34;chat.completion&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;created&#34;</span>: 1693542489,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;model&#34;</span>: <span style=color:#b44>&#34;gpt-4&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_annotations&#34;</span>: <span style=color:#666>[</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_index&#34;</span>: 0,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;content_filter_results&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;hate&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;self_harm&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;sexual&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;violence&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>]</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;choices&#34;</span>: <span style=color:#666>[</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;index&#34;</span>: 0,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;finish_reason&#34;</span>: <span style=color:#b44>&#34;function_call&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;message&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;role&#34;</span>: <span style=color:#b44>&#34;assistant&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;function_call&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;name&#34;</span>: <span style=color:#b44>&#34;extract_all_info&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;arguments&#34;</span>: <span style=color:#b44>&#34;{\n\&#34;name\&#34;: \&#34;Enigma Zhao\&#34;,\n\&#34;job_title\&#34;: \&#34;Azure cloud engineer\&#34;,\n\&#34;num_children\&#34;: 3,\n\&#34;vehicle_make\&#34;: \&#34;Audi\&#34;,\n\&#34;vehicle_model\&#34;: \&#34;A3\&#34;,\n\&#34;company_name\&#34;: \&#34;Microsoft\&#34;,\n\&#34;favorite_vg_series\&#34;: \&#34;The Legend of Zelda\&#34;\n}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;content_filter_results&#34;</span>: <span style=color:#666>{}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>]</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;usage&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;completion_tokens&#34;</span>: 67,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_tokens&#34;</span>: 320,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;total_tokens&#34;</span>: <span style=color:#666>387</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span>Sample <span style=color:#080;font-style:italic>#2&#39;s results:</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;id&#34;</span>: <span style=color:#b44>&#34;chatcmpl-7tq3QUA3o1yixTLZoPtuWOfKA38ub&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;object&#34;</span>: <span style=color:#b44>&#34;chat.completion&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;created&#34;</span>: 1693542492,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;model&#34;</span>: <span style=color:#b44>&#34;gpt-4&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_annotations&#34;</span>: <span style=color:#666>[</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_index&#34;</span>: 0,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;content_filter_results&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;hate&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;self_harm&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;sexual&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;violence&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>]</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;choices&#34;</span>: <span style=color:#666>[</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;index&#34;</span>: 0,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;finish_reason&#34;</span>: <span style=color:#b44>&#34;function_call&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;message&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;role&#34;</span>: <span style=color:#b44>&#34;assistant&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;function_call&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;name&#34;</span>: <span style=color:#b44>&#34;extract_person_info&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;arguments&#34;</span>: <span style=color:#b44>&#34;{\n\&#34;name\&#34;: \&#34;David Hundley\&#34;,\n\&#34;job_title\&#34;: \&#34;principal machine learning engineer\&#34;,\n\&#34;num_children\&#34;: 2\n}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;content_filter_results&#34;</span>: <span style=color:#666>{}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>]</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;usage&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;completion_tokens&#34;</span>: 33,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_tokens&#34;</span>: 282,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;total_tokens&#34;</span>: <span style=color:#666>315</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span>Sample <span style=color:#080;font-style:italic>#3&#39;s results:</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;id&#34;</span>: <span style=color:#b44>&#34;chatcmpl-7tq3RxN3tCLKbPadWkGQguploKFw2&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;object&#34;</span>: <span style=color:#b44>&#34;chat.completion&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;created&#34;</span>: 1693542493,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;model&#34;</span>: <span style=color:#b44>&#34;gpt-4&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_annotations&#34;</span>: <span style=color:#666>[</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_index&#34;</span>: 0,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;content_filter_results&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;hate&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;self_harm&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;sexual&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;violence&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;filtered&#34;</span>: false,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;severity&#34;</span>: <span style=color:#b44>&#34;safe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>]</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;choices&#34;</span>: <span style=color:#666>[</span>
</span></span><span style=display:flex><span><span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;index&#34;</span>: 0,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;finish_reason&#34;</span>: <span style=color:#b44>&#34;function_call&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;message&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;role&#34;</span>: <span style=color:#b44>&#34;assistant&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;function_call&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;name&#34;</span>: <span style=color:#b44>&#34;extract_vehicle_info&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;arguments&#34;</span>: <span style=color:#b44>&#34;{\n  \&#34;vehicle_make\&#34;: \&#34;Kia\&#34;,\n  \&#34;vehicle_model\&#34;: \&#34;Sportage\&#34;\n}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;content_filter_results&#34;</span>: <span style=color:#666>{}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>]</span>,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;usage&#34;</span>: <span style=color:#666>{</span>
</span></span><span style=display:flex><span><span style=color:#b44>&#34;completion_tokens&#34;</span>: 27,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;prompt_tokens&#34;</span>: 268,
</span></span><span style=display:flex><span><span style=color:#b44>&#34;total_tokens&#34;</span>: <span style=color:#666>295</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span></code></pre></div><p>对于每个相应的提示，ChatGPT选择了正确的自定义函数，可以特别注意到API的响应对象中function_call下的name值。</p><p>除了这是一种方便的方法来确定使用哪个函数的参数之外，我们还可以通过编程将实际的自定义Python函数映射到此值，以适当地选择运行正确的代码。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic># Iterating over the three samples</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>for</span> i, sample <span style=color:#a2f;font-weight:700>in</span> <span style=color:#a2f>enumerate</span>(samples):
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a2f>print</span>(<span style=color:#b44>f</span><span style=color:#b44>&#39;Sample #</span><span style=color:#b68;font-weight:700>{</span>i <span style=color:#666>+</span> <span style=color:#666>1</span><span style=color:#b68;font-weight:700>}</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s results:&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic># Getting the response back from ChatGPT (gpt-4)</span>
</span></span><span style=display:flex><span>    openai_response <span style=color:#666>=</span> openai<span style=color:#666>.</span>ChatCompletion<span style=color:#666>.</span>create(
</span></span><span style=display:flex><span>        engine <span style=color:#666>=</span> <span style=color:#b44>&#39;gpt-4&#39;</span>,
</span></span><span style=display:flex><span>        messages <span style=color:#666>=</span> [{<span style=color:#b44>&#39;role&#39;</span>: <span style=color:#b44>&#39;user&#39;</span>, <span style=color:#b44>&#39;content&#39;</span>: sample}],
</span></span><span style=display:flex><span>        functions <span style=color:#666>=</span> my_custom_functions,
</span></span><span style=display:flex><span>        function_call <span style=color:#666>=</span> <span style=color:#b44>&#39;auto&#39;</span>
</span></span><span style=display:flex><span>    )[<span style=color:#b44>&#39;choices&#39;</span>][<span style=color:#666>0</span>][<span style=color:#b44>&#39;message&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic># Checking to see that a function call was invoked</span>
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>if</span> openai_response<span style=color:#666>.</span>get(<span style=color:#b44>&#39;function_call&#39;</span>):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#080;font-style:italic># Checking to see which specific function call was invoked</span>
</span></span><span style=display:flex><span>        function_called <span style=color:#666>=</span> openai_response[<span style=color:#b44>&#39;function_call&#39;</span>][<span style=color:#b44>&#39;name&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#080;font-style:italic># Extracting the arguments of the function call</span>
</span></span><span style=display:flex><span>        function_args <span style=color:#666>=</span> json<span style=color:#666>.</span>loads(openai_response[<span style=color:#b44>&#39;function_call&#39;</span>][<span style=color:#b44>&#39;arguments&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#080;font-style:italic># Invoking the proper functions</span>
</span></span><span style=display:flex><span>        <span style=color:#a2f;font-weight:700>if</span> function_called <span style=color:#666>==</span> <span style=color:#b44>&#39;extract_person_info&#39;</span>:
</span></span><span style=display:flex><span>            extract_person_info(<span style=color:#666>*</span><span style=color:#a2f>list</span>(function_args<span style=color:#666>.</span>values()))
</span></span><span style=display:flex><span>        <span style=color:#a2f;font-weight:700>elif</span> function_called <span style=color:#666>==</span> <span style=color:#b44>&#39;extract_vehicle_info&#39;</span>:
</span></span><span style=display:flex><span>            extract_vehicle_info(<span style=color:#666>*</span><span style=color:#a2f>list</span>(function_args<span style=color:#666>.</span>values()))
</span></span><span style=display:flex><span>        <span style=color:#a2f;font-weight:700>elif</span> function_called <span style=color:#666>==</span> <span style=color:#b44>&#39;extract_all_info&#39;</span>:
</span></span><span style=display:flex><span>            extract_all_info(<span style=color:#666>*</span><span style=color:#a2f>list</span>(function_args<span style=color:#666>.</span>values()))
</span></span></code></pre></div><p>输出如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@ubuntu0:~/python# python3 fc4.py 
</span></span><span style=display:flex><span>Sample <span style=color:#080;font-style:italic>#1&#39;s results:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    This person<span style=color:#b44>&#39;s name is Enigma Zhao. Their job title is Azure cloud engineer, and they have 3 children.
</span></span></span><span style=display:flex><span><span style=color:#b44>    They drive a Audi A3.
</span></span></span><span style=display:flex><span><span style=color:#b44>    They work for Microsoft.
</span></span></span><span style=display:flex><span><span style=color:#b44>    Their favorite video game series is The Legend of Zelda.
</span></span></span><span style=display:flex><span><span style=color:#b44>    
</span></span></span><span style=display:flex><span><span style=color:#b44>Sample #2&#39;</span>s results:
</span></span><span style=display:flex><span>This person<span style=color:#b44>&#39;s name is David Hundley. Their job title is principal machine learning engineer, and they have 2 children.
</span></span></span><span style=display:flex><span><span style=color:#b44>Sample #3&#39;</span>s results:
</span></span><span style=display:flex><span>Vehicle make: Kia
</span></span><span style=display:flex><span>Vehicle model: Sportage
</span></span></code></pre></div><h2 id=openai-function-calling-with-langchain><strong>OpenAI Function Calling with LangChain</strong></h2><p>考虑到LangChain在生成式AI社区中的受欢迎程度，添加一些代码来展示如何在LangChain中使用这个功能。</p><p>注意在使用前要安装 LangChain</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pip3 install LangChain
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic># Importing the LangChain objects</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>langchain.chat_models</span> <span style=color:#a2f;font-weight:700>import</span> ChatOpenAI
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>langchain.chains</span> <span style=color:#a2f;font-weight:700>import</span> LLMChain
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>langchain.prompts.chat</span> <span style=color:#a2f;font-weight:700>import</span> ChatPromptTemplate
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>langchain.chains.openai_functions</span> <span style=color:#a2f;font-weight:700>import</span> create_structured_output_chain
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Setting the proper instance of the OpenAI model</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#llm = ChatOpenAI(model = &#39;gpt-3.5-turbo-0613&#39;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#666>**</span><span style=color:#080;font-style:italic>#model 格式发生改变，如果用ChatOpenAI(model = &#39;gpt-4&#39;)，系统会给警告</span>
</span></span><span style=display:flex><span>llm <span style=color:#666>=</span> ChatOpenAI(model_kwargs<span style=color:#666>=</span>{<span style=color:#b44>&#39;engine&#39;</span>: <span style=color:#b44>&#39;gpt-4&#39;</span>})<span style=color:#666>**</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Setting a LangChain ChatPromptTemplate</span>
</span></span><span style=display:flex><span>chat_prompt_template <span style=color:#666>=</span> ChatPromptTemplate<span style=color:#666>.</span>from_template(<span style=color:#b44>&#39;</span><span style=color:#b68;font-weight:700>{my_prompt}</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Setting the JSON schema for extracting vehicle information</span>
</span></span><span style=display:flex><span>langchain_json_schema <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;name&#39;</span>: <span style=color:#b44>&#39;extract_vehicle_info&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Extract the make and model of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s car&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;object&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#b44>&#39;properties&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;vehicle_make&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;title&#39;</span>: <span style=color:#b44>&#39;Vehicle Make&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Make of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s vehicle&#39;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#b44>&#39;vehicle_model&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;title&#39;</span>: <span style=color:#b44>&#39;Vehicle Model&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;type&#39;</span>: <span style=color:#b44>&#39;string&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#b44>&#39;description&#39;</span>: <span style=color:#b44>&#39;Model of the person</span><span style=color:#b62;font-weight:700>\&#39;</span><span style=color:#b44>s vehicle&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Defining the LangChain chain object for function calling</span>
</span></span><span style=display:flex><span>chain <span style=color:#666>=</span> create_structured_output_chain(output_schema <span style=color:#666>=</span> langchain_json_schema,
</span></span><span style=display:flex><span>                                       llm <span style=color:#666>=</span> llm,
</span></span><span style=display:flex><span>                                       prompt <span style=color:#666>=</span> chat_prompt_template)
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># Getting results with a demo prompt</span>
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(chain<span style=color:#666>.</span>run(my_prompt <span style=color:#666>=</span> about_me))
</span></span></code></pre></div><p>输出如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>root<span style=color:#a2f>@ubuntu0</span>:<span style=color:#666>~/</span>python<span style=color:#080;font-style:italic># python3 fc0.py </span>
</span></span><span style=display:flex><span>{<span style=color:#b44>&#39;vehicle_make&#39;</span>: <span style=color:#b44>&#39;Audi&#39;</span>, <span style=color:#b44>&#39;vehicle_model&#39;</span>: <span style=color:#b44>&#39;A3&#39;</span>}
</span></span></code></pre></div></div><footer class=post-footer><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview>站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/img/avatar.png alt=Etaon><p class=site-author-name itemprop=name>Etaon</p><p class="site-description motion-element" itemprop=description>Kepp Going!</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>80</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>15</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>43</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/etaon target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span>
<span class=links-of-author-item><a href=https://blog.csdn.net/weixin_43394724 target=_blank title=CSDN><i class="fa fa-fw fa-CSDN"></i>
CSDN</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class=links-of-blogroll-title><i class="fa fa-fw fa-globe"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://kubernetes.io/ title=Kubernetes target=_blank>Kubernetes</a></li><li class=links-of-blogroll-item><a href=https://cisco.com/ title=Cisco target=_blank>Cisco</a></li><li class=links-of-blogroll-item><a href=https://www.w3school.com.cn/ title=W3School target=_blank>W3School</a></li><li class=links-of-blogroll-item><a href=https://www.liaoxuefeng.com/ title=廖雪峰 target=_blank>廖雪峰</a></li></ul></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>
标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/mysql>Mysql</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/aws>Aws</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/dql>Dql</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/hadoop>Hadoop</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/kubernetes>Kubernetes</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/nsx-t>Nsx t</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/redis>Redis</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/azure>Azure</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/cicd>Cicd</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/git>Git</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#概述>概述</a><ul><li><a href=#初始化配置>初始化配置</a></li><li><a href=#测试json-转换>测试Json 转换</a></li><li><a href=#简单的自定义函数>简单的自定义函数</a></li><li><a href=#多样本情况>多样本情况</a></li></ul></li><li><a href=#openai-function-calling-with-langchain><strong>OpenAI Function Calling with LangChain</strong></a></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2010 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>路无止境！</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.101.0</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span class=site-uv><i class="fa fa-user"></i>
<span class=busuanzi-value id=busuanzi_value_site_uv></span></span>
<span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i>
<span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div><div class=license-info><span class=storage-info>Storage by
<a href=https://www.azure.com/ style=font-weight:700 target=_blank>Azure static web apps</a></span>
<span class=separator-line>/</span>
<span class=license-num><a href target=_blank></a></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){var t=$("#content").height(),e=$(window).height(),n=t>e?t-e:$(document).height()-e;return n}function getScrollbarWidth(){var e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){var t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);var s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){var t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){var e=$(".header-inner").height(),t=parseInt($(".main").css("padding-bottom"),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}}),$(document).on("affixed.bs.affix",function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){var e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);var e,t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){var e,t,n,s,o=$(".header-inner").height()+10;$("#sidebar").css({"margin-top":o}).show(),t=parseInt($("#sidebar").css("margin-top")),n=parseInt($(".sidebar-inner").css("height")),e=t+n,s=$(".content-wrap").height(),s<e&&$(".content-wrap").css("min-height",e),$(".site-nav-toggle").on("click",function(){var e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script><script type=text/javascript>$(function(){detectIE()>0?$.getScript(document.location.protocol+"//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js",function(){new Waline({el:"#wcomments",visitor:!0,avatar:"wavatar",avatarCDN:"https://sdn.geekzu.org/avatar/",avatarForce:!1,wordLimit:"200",placeholder:" 欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^ ",requiredFields:["nick","mail"],serverURL:"Your WalineSerURL",lang:"zh-cn"})}):$("#wcomments").html("抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。")})</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script>
<script>(function(){var t,e=document.createElement("script"),n=window.location.protocol.split(":")[0];n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>