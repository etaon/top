<!doctype html><html lang=zh-cn dir=content/zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests">
<title> MongoDB-基本操作 - 路无止境！ </title>
<meta name=keywords content="博客,架构师,思考,读书,笔记,技术,分享,云">
<meta name=author content="Etaon">
<meta property="og:title" content="MongoDB-基本操作">
<meta property="og:site_name" content="路无止境！">
<meta property="og:image" content="/img/author.jpg">
<meta name=title content="MongoDB-基本操作 - 路无止境！">
<meta name=description content="欢迎来到ETAON空间站，个人主要专注于Infra系统架构，私有/公有云产品，售前及微服务解决方案。">
<link rel="shortcut icon" href=/img/favicon.ico>
<link rel=apple-touch-icon href=/img/apple-touch-icon.png>
<link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png>
<link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css>
<link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet type=text/css>
<link href=/css/syntax.css rel=stylesheet type=text/css>
</head>
<body itemscope itemtype=http://schema.org/WebPage lang=zh-hans>
<div class="container one-collumn sidebar-position-left page-home">
<div class=headband></div>
<header id=header class=header itemscope itemtype=http://schema.org/WPHeader>
<div class=header-inner> <div class=site-brand-container>
<div class=site-nav-toggle>
<div class=toggle role=button style=opacity:1;top:0>
<span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span>
</div>
</div>
<div class=site-meta>
<div class=multi-lang-switch>
<i class="fa fa-fw fa-language" style=margin-right:5px></i>
<a class=lang-link id=zh-cn href=#>中文</a>
</div>
<div class=custom-logo-site-title>
<a href=/ class=brand rel=start>
<span class=logo-line-before><i></i></span>
<span class=site-title>路无止境！</span>
<span class=logo-line-after><i></i></span>
</a>
</div>
<p class=site-subtitle>没有伞的孩子要学会努力奔跑!</p>
</div>
<div class=site-nav-right>
<div class="toggle popup-trigger" style=opacity:1;top:0>
<i class="fa fa-search fa-fw fa-lg"></i>
</div>
</div>
</div>
<nav class=site-nav>
<ul id=menu class=menu>
<li class=menu-item>
<a href=/ rel=section>
<i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页
</a>
</li>
<li class=menu-item>
<a href=/post rel=section>
<i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档
</a>
</li>
<li class=menu-item>
<a href=/about.html rel=section>
<i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于我
</a>
</li>
<li class=menu-item>
<a href=/404.html rel=section>
<i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>公益404
</a>
</li>
<li class="menu-item menu-item-search">
<a href=javascript:; class=popup-trigger> <i class="menu-item-icon fa fa-search fa-fw"></i> <br> 搜索</a>
</li>
</ul>
<div class=site-search>
<div class="popup search-popup local-search-popup">
<div class="local-search-header clearfix">
<span class=search-icon><i class="fa fa-search"></i> </span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span>
<div class=local-search-input-wrapper>
<input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off>
</div>
</div>
<div id=local-search-result></div>
</div>
</div>
</nav>
</div>
</header>
<main id=main class=main>
<div class=main-inner>
<div class=content-wrap>
<div id=content class=content>
<section id=posts class=posts-expand>
<article class="post post-type-normal" itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline" style=font-weight:700>
<a class=post-title-link href=https://www.etaon.link/2022/02/01/mongodb-basic.html itemprop=url>
MongoDB-基本操作
</a>
</h1>
</header>
<div class=post-body itemprop=articleBody>
<h2 id=数据库操作>数据库操作</h2>
<h3 id=创建>创建</h3>
<ul>
<li>选择和创建数据库的语法格式：
如果数据库不存在则自动创建，例如，以下语句创建 spitdb 数据库：</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>use spitdb
</code></pre></div><h3 id=查看>查看</h3>
<ul>
<li>查看当前正在使用的数据库命令</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>show dbs
或
show databases

&gt; show dbs
admin   0.000GB
config  0.000GB
<span style=color:#a2f>local</span>   0.000GB
mydb    0.000GB
</code></pre></div><ul>
<li>查看有权限查看的所有的数据库命令</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db

&gt; db
<span style=color:#a2f>test</span>
</code></pre></div><p>MongoDB 中默认的数据库为 test，如果你没有选择数据库，集合将存放在 test 数据库中。</p>
<p><em>注意: 在 MongoDB 中，集合只有在内容插入后才会创建! 就是说，创建集合(数据表)后要再插入一个文档(记录)，集合才会真正创建。</em></p>
<p>另外：
数据库名可以是满足以下条件的任意UTF-8字符串。</p>
<blockquote>
<ul>
<li>不能是空字符串（"")。</li>
<li>不得含有' &lsquo;（空格)、.、$、/、\和\0 (空字符)。</li>
<li>应全部小写。</li>
<li>最多64字节。</li>
</ul>
</blockquote>
<p>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。</p>
<blockquote>
<p><strong>admin</strong>： 从权限的角度来看，这是"root"数据库。要是将一个用户添加到这个数据库，该用户自动继承所有数据库的权限。
一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。</p>
<p><strong>local</strong>: 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</p>
<p><strong>config</strong>: 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。</p>
</blockquote>
<h3 id=删除>删除</h3>
<ul>
<li>数据库的删除
MongoDB 删除数据库的语法格式如下：</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.dropDatabase<span style=color:#666>()</span>

db.dropDatabase<span style=color:#666>()</span>
<span style=color:#666>{</span> ok: 1, dropped: <span style=color:#b44>&#39;mydb&#39;</span> <span style=color:#666>}</span>
</code></pre></div><h2 id=集合操作>集合操作</h2>
<h3 id=集合创建>集合创建</h3>
<ul>
<li>集合的隐式创建
当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合。</li>
<li>集合的显式创建（了解）</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>基本语法格式：
db.createCollection<span style=color:#666>(</span>name<span style=color:#666>)</span>
name: 要创建的集合名称
</code></pre></div><blockquote>
<p>集合的命名规范：</p>
<ul>
<li>集合名不能是空字符串""。</li>
<li>集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。</li>
<li>集合名不能以"system.&ldquo;开头，这是为系统集合保留的前缀。</li>
<li>用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。</li>
</ul>
</blockquote>
<h3 id=删除集合>删除集合</h3>
<p>集合删除语法格式如下：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.drop<span style=color:#666>()</span>
或
db.集合.drop<span style=color:#666>()</span>

db.comment.drop<span style=color:#666>()</span>
<span style=color:#a2f>true</span>
</code></pre></div><blockquote>
<p>如果成功删除选定集合，则 drop() 方法返回 true，否则返回 false。</p>
</blockquote>
<h2 id=文档document的操作>文档（document）的操作</h2>
<p>文档（document）的数据结构和 JSON 基本一样，所有存储在集合中的数据都是 BSON 格式。</p>
<h3 id=插入>插入</h3>
<ul>
<li>单条文档插入</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.insert<span style=color:#666>(</span>
&lt;document or array of documents&gt;,
<span style=color:#666>{</span>
writeConcern: &lt;document&gt;,
ordered: &lt;boolean&gt;
<span style=color:#666>}</span>
<span style=color:#666>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>document</td>
<td>document or array</td>
<td>要插入到集合中的文档或文档数组。（(json格式）</td>
</tr>
<tr>
<td>writeConcern</td>
<td>document</td>
<td>Optional. A document expressing the write concern. Omit to use the default write concern.See Write Concern.Do not explicitly set the write concern for the operation if run in a transaction. To use write concern with transactions, see Transactions and Write Concern.</td>
</tr>
<tr>
<td>ordered</td>
<td>boolean</td>
<td>可选。如果为真，则按顺序插入数组中的文档，如果其中一个文档出现错误，MongoDB将返回而不处理数组中的其余文档。如果为假，则执行无序插入，如果其中一个文档出现错误，则继续处理数组中的主文档。在版本2.6+中默认为true</td>
</tr>
</tbody>
</table>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.insert<span style=color:#666>({</span><span style=color:#b44>&#34;_id&#34;</span>:<span style=color:#b44>&#34;0&#34;</span>,<span style=color:#b44>&#34;articleid&#34;</span>:<span style=color:#b44>&#34;100000&#34;</span>,<span style=color:#b44>&#34;content&#34;</span>:<span style=color:#b44>&#34;今天天气真好，阳光明媚&#34;</span>,<span style=color:#b44>&#34;userid&#34;</span>:<span style=color:#b44>&#34;1001&#34;</span>,<span style=color:#b44>&#34;nickname&#34;</span>:<span style=color:#b44>&#34;Rose&#34;</span>,<span style=color:#b44>&#34;createdatetime&#34;</span>:new Date<span style=color:#666>()</span>,<span style=color:#b44>&#34;likenum&#34;</span>:NumberInt<span style=color:#666>(</span>10<span style=color:#666>)</span>,<span style=color:#b44>&#34;state&#34;</span>:null<span style=color:#666>})</span>
<span style=color:#666>{</span> acknowledged: true, insertedIds: <span style=color:#666>{</span> <span style=color:#b44>&#39;0&#39;</span>: <span style=color:#b44>&#39;0&#39;</span> <span style=color:#666>}</span> <span style=color:#666>}</span>
</code></pre></div><p>1）comment集合如果不存在，则会隐式创建</p>
<p>2）mongo中的数字，默认情况下是double类型，如果要存整型，必须使用函数NumberInt(整型数字)，否则取出来就有问题了。</p>
<p>3）插入当前日期使用 new Date()</p>
<p>4）插入的数据如果没有指定 _id ，会自动生成主键值</p>
<p>5）如果某字段没值，可以赋值为null，或不写该字段。</p>
<blockquote>
</blockquote>
<p>注意：</p>
<ol>
<li>文档中的键/值对是有序的。</li>
<li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</li>
<li>MongoDB区分类型和大小写。</li>
<li>MongoDB的文档不能有重复的键。</li>
<li>文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。</li>
</ol>
<blockquote>
<p>文档键命名规范：
键不能含有\0 (空字符)。这个字符用来表示键的结尾。
.和$有特别的意义，只有在特定环境下才能使用。
以下划线&rdquo;_&ldquo;开头的键是保留的(不是严格要求的)。</p>
</blockquote>
<ul>
<li>多条文档插入</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.insertMany<span style=color:#666>(</span>
<span style=color:#666>[</span> &lt;document 1&gt; , &lt;document 2&gt;, ... <span style=color:#666>]</span>,
<span style=color:#666>{</span>
writeConcern: &lt;document&gt;,
ordered: &lt;boolean&gt;
<span style=color:#666>}</span>
<span style=color:#666>)</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.insertMany<span style=color:#666>([{</span><span style=color:#b44>&#34;_id&#34;</span>:<span style=color:#b44>&#34;1&#34;</span>,<span style=color:#b44>&#34;articleid&#34;</span>:<span style=color:#b44>&#34;100001&#34;</span>,<span style=color:#b44>&#34;content&#34;</span>:<span style=color:#b44>&#34;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&#34;</span>,<span style=color:#b44>&#34;userid&#34;</span>:<span style=color:#b44>&#34;1002&#34;</span>,<span style=color:#b44>&#34;nickname&#34;</span>:<span style=color:#b44>&#34;相忘于江湖&#34;</span>,<span style=color:#b44>&#34;createdatetime&#34;</span>:new Date<span style=color:#666>(</span><span style=color:#b44>&#34;2019-08-05T22:08:15.522Z&#34;</span><span style=color:#666>)</span>,<span style=color:#b44>&#34;likenum&#34;</span>:NumberInt<span style=color:#666>(</span>1000<span style=color:#666>)</span>,<span style=color:#b44>&#34;state&#34;</span>:<span style=color:#b44>&#34;1&#34;</span><span style=color:#666>}</span>,<span style=color:#666>{</span><span style=color:#b44>&#34;_id&#34;</span>:<span style=color:#b44>&#34;2&#34;</span>,<span style=color:#b44>&#34;articleid&#34;</span>:<span style=color:#b44>&#34;100001&#34;</span>,<span style=color:#b44>&#34;content&#34;</span>:<span style=color:#b44>&#34;我夏天空腹喝凉开水，冬天喝温开水&#34;</span>,<span style=color:#b44>&#34;userid&#34;</span>:<span style=color:#b44>&#34;1005&#34;</span>,<span style=color:#b44>&#34;nickname&#34;</span>:<span style=color:#b44>&#34;伊人憔悴&#34;</span>,<span style=color:#b44>&#34;createdatetime&#34;</span>:new Date<span style=color:#666>(</span><span style=color:#b44>&#34;2019-08-05T23:58:51.485Z&#34;</span><span style=color:#666>)</span>,<span style=color:#b44>&#34;likenum&#34;</span>:NumberInt<span style=color:#666>(</span>888<span style=color:#666>)</span>,<span style=color:#b44>&#34;state&#34;</span>:<span style=color:#b44>&#34;1&#34;</span><span style=color:#666>}</span>,<span style=color:#666>{</span><span style=color:#b44>&#34;_id&#34;</span>:<span style=color:#b44>&#34;3&#34;</span>,<span style=color:#b44>&#34;articleid&#34;</span>:<span style=color:#b44>&#34;100001&#34;</span>,<span style=color:#b44>&#34;content&#34;</span>:<span style=color:#b44>&#34;我一直喝凉开水，冬天夏天都喝。&#34;</span>,<span style=color:#b44>&#34;userid&#34;</span>:<span style=color:#b44>&#34;1004&#34;</span>,<span style=color:#b44>&#34;nickname&#34;</span>:<span style=color:#b44>&#34;杰克船长&#34;</span>,<span style=color:#b44>&#34;createdatetime&#34;</span>:new Date<span style=color:#666>(</span><span style=color:#b44>&#34;2019-08-06T01:05:06.321Z&#34;</span><span style=color:#666>)</span>,<span style=color:#b44>&#34;likenum&#34;</span>:NumberInt<span style=color:#666>(</span>666<span style=color:#666>)</span>,<span style=color:#b44>&#34;state&#34;</span>:<span style=color:#b44>&#34;1&#34;</span><span style=color:#666>}</span>,<span style=color:#666>{</span><span style=color:#b44>&#34;_id&#34;</span>:<span style=color:#b44>&#34;4&#34;</span>,<span style=color:#b44>&#34;articleid&#34;</span>:<span style=color:#b44>&#34;100001&#34;</span>,<span style=color:#b44>&#34;content&#34;</span>:<span style=color:#b44>&#34;专家说不能空腹吃饭，影响健康。&#34;</span>,<span style=color:#b44>&#34;userid&#34;</span>:<span style=color:#b44>&#34;1003&#34;</span>,<span style=color:#b44>&#34;nickname&#34;</span>:<span style=color:#b44>&#34;凯撒&#34;</span>,<span style=color:#b44>&#34;createdatetime&#34;</span>:new Date<span style=color:#666>(</span><span style=color:#b44>&#34;2019-08-06T08:18:35.288Z&#34;</span><span style=color:#666>)</span>,<span style=color:#b44>&#34;likenum&#34;</span>:NumberInt<span style=color:#666>(</span>2000<span style=color:#666>)</span>,<span style=color:#b44>&#34;state&#34;</span>:<span style=color:#b44>&#34;1&#34;</span><span style=color:#666>}</span>,<span style=color:#666>{</span><span style=color:#b44>&#34;_id&#34;</span>:<span style=color:#b44>&#34;5&#34;</span>,<span style=color:#b44>&#34;articleid&#34;</span>:<span style=color:#b44>&#34;100001&#34;</span>,<span style=color:#b44>&#34;content&#34;</span>:<span style=color:#b44>&#34;研究表明，刚烧开的水千万不能喝，因为烫嘴。&#34;</span>,<span style=color:#b44>&#34;userid&#34;</span>:<span style=color:#b44>&#34;1003&#34;</span>,<span style=color:#b44>&#34;nickname&#34;</span>:<span style=color:#b44>&#34;凯撒&#34;</span>,<span style=color:#b44>&#34;createdatetime&#34;</span>:new Date<span style=color:#666>(</span><span style=color:#b44>&#34;2019-08-06T11:01:02.521Z&#34;</span><span style=color:#666>)</span>,<span style=color:#b44>&#34;likenum&#34;</span>:NumberInt<span style=color:#666>(</span>3000<span style=color:#666>)</span>,<span style=color:#b44>&#34;state&#34;</span>:<span style=color:#b44>&#34;1&#34;</span><span style=color:#666>}])</span>;
<span style=color:#666>{</span> acknowledged: true,
  insertedIds: <span style=color:#666>{</span> <span style=color:#b44>&#39;0&#39;</span>: <span style=color:#b44>&#39;1&#39;</span>, <span style=color:#b44>&#39;1&#39;</span>: <span style=color:#b44>&#39;2&#39;</span>, <span style=color:#b44>&#39;2&#39;</span>: <span style=color:#b44>&#39;3&#39;</span>, <span style=color:#b44>&#39;3&#39;</span>: <span style=color:#b44>&#39;4&#39;</span>, <span style=color:#b44>&#39;4&#39;</span>: <span style=color:#b44>&#39;5&#39;</span> <span style=color:#666>}</span> <span style=color:#666>}</span>
</code></pre></div><blockquote>
<p>1)插入时指定了 _id ，则主键就是该值。
2)如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉。
3)因为批量插入由于数据较多容易出现失败，因此，可以使用try catch进行异常捕捉处理，测试的时候可以不处理。</p>
</blockquote>
<h3 id=查询>查询</h3>
<p>查询数据的语法格式如下：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.find<span style=color:#666>(</span>&lt;query&gt;, <span style=color:#666>[</span>projection<span style=color:#666>])</span>
</code></pre></div><table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>document</td>
<td>可选。使用查询运算符指定选择筛选器。若要返回集合中的所有文档，请省略此参数或传递空文档( {} )</td>
</tr>
<tr>
<td>projection</td>
<td>document</td>
<td>可选。指定要在与查询筛选器匹配的文档中返回的字段（投影）。若要返回匹配文档中的所有字段，请省略此参数。</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>查询所有</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>()</span> <span style=color:#080;font-style:italic>#或find({})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;0&#39;</span>,
  articleid: <span style=color:#b44>&#39;100000&#39;</span>,
  content: <span style=color:#b44>&#39;今天天气真好，阳光明媚&#39;</span>,
  userid: <span style=color:#b44>&#39;1001&#39;</span>,
  nickname: <span style=color:#b44>&#39;Rose&#39;</span>,
  createdatetime: 2022-01-21T12:57:49.081Z,
  likenum: 10,
  state: null <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&#39;</span>,
  userid: <span style=color:#b44>&#39;1002&#39;</span>,
  nickname: <span style=color:#b44>&#39;相忘于江湖&#39;</span>,
  createdatetime: 2019-08-05T22:08:15.522Z,
  likenum: 1000,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;我夏天空腹喝凉开水，冬天喝温开水&#39;</span>,
  userid: <span style=color:#b44>&#39;1005&#39;</span>,
  nickname: <span style=color:#b44>&#39;伊人憔悴&#39;</span>,
  createdatetime: 2019-08-05T23:58:51.485Z,
  likenum: 888,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
......
</code></pre></div></li>
<li>
<p>查询某些</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>content:1,nikename:1<span style=color:#666>})</span> <span style=color:#080;font-style:italic>#注意：1</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;0&#39;</span>, content: <span style=color:#b44>&#39;今天天气真好，阳光明媚&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>, content: <span style=color:#b44>&#39;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>, content: <span style=color:#b44>&#39;我夏天空腹喝凉开水，冬天喝温开水&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, content: <span style=color:#b44>&#39;我一直喝凉开水，冬天夏天都喝。&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;4&#39;</span>, content: <span style=color:#b44>&#39;专家说不能空腹吃饭，影响健康。&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;5&#39;</span>, content: <span style=color:#b44>&#39;研究表明，刚烧开的水千万不能喝，因为烫嘴。&#39;</span> <span style=color:#666>}</span>
</code></pre></div><ul>
<li>条件查询</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>({</span>userid:<span style=color:#b44>&#39;1004&#39;</span><span style=color:#666>}</span>,<span style=color:#666>{</span>content:1,nikename:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, content: <span style=color:#b44>&#39;我一直喝凉开水，冬天夏天都喝。&#39;</span> <span style=color:#666>}</span>
</code></pre></div><ul>
<li>去除索引</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>content:1,nikename:1,_id:0<span style=color:#666>})</span> **#_id:0**
<span style=color:#666>{</span> content: <span style=color:#b44>&#39;今天天气真好，阳光明媚&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> content: <span style=color:#b44>&#39;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> content: <span style=color:#b44>&#39;我夏天空腹喝凉开水，冬天喝温开水&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> content: <span style=color:#b44>&#39;我一直喝凉开水，冬天夏天都喝。&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> content: <span style=color:#b44>&#39;专家说不能空腹吃饭，影响健康。&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> content: <span style=color:#b44>&#39;研究表明，刚烧开的水千万不能喝，因为烫嘴。&#39;</span> <span style=color:#666>}</span>
<span style=color:#080;font-style:italic>#记录名写错，系统不会提醒报错，如上面，nickname写成了nikename</span>
</code></pre></div><ul>
<li>统计查询</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.count<span style=color:#666>(</span>query, options<span style=color:#666>)</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>()</span>.count<span style=color:#666>()</span>
<span style=color:#666>6</span>
db.comment.countDocuments<span style=color:#666>({</span>userid:<span style=color:#b44>&#39;1003&#39;</span><span style=color:#666>})</span>
<span style=color:#666>2</span>
</code></pre></div><ul>
<li>分页列表查询</li>
</ul>
<p>使用limit()方法来读取指定数量的数据，使用skip()方法来跳过指定数量的数据</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>userid:1,nicknam:1,likenum:1<span style=color:#666>})</span>.limit<span style=color:#666>(</span>2<span style=color:#666>)</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;0&#39;</span>, userid: <span style=color:#b44>&#39;1001&#39;</span>, likenum: <span style=color:#666>10</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>, userid: <span style=color:#b44>&#39;1002&#39;</span>, likenum: <span style=color:#666>1000</span> <span style=color:#666>}</span>
db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>userid:1,nicknam:1,likenum:1<span style=color:#666>})</span>.limit<span style=color:#666>(</span>2<span style=color:#666>)</span>.skip<span style=color:#666>(</span>2<span style=color:#666>)</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>, userid: <span style=color:#b44>&#39;1005&#39;</span>, likenum: <span style=color:#666>888</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, userid: <span style=color:#b44>&#39;1004&#39;</span>, likenum: <span style=color:#666>666</span> <span style=color:#666>}</span>
</code></pre></div><ul>
<li>排序</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.COLLECTION_NAME.find<span style=color:#666>()</span>.sort<span style=color:#666>({</span>KEY:1<span style=color:#666>})</span>
或
db.集合名称.find<span style=color:#666>()</span>.sort<span style=color:#666>(</span>排序方式<span style=color:#666>)</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&gt; db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>userid:1,nickname:1<span style=color:#666>})</span>.sort<span style=color:#666>({</span>nickname:1<span style=color:#666>})</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;0&#34;</span>, <span style=color:#b44>&#34;userid&#34;</span> : <span style=color:#b44>&#34;1001&#34;</span>, <span style=color:#b44>&#34;nickname&#34;</span> : <span style=color:#b44>&#34;Rose&#34;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;2&#34;</span>, <span style=color:#b44>&#34;userid&#34;</span> : <span style=color:#b44>&#34;1005&#34;</span>, <span style=color:#b44>&#34;nickname&#34;</span> : <span style=color:#b44>&#34;伊人憔悴&#34;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;4&#34;</span>, <span style=color:#b44>&#34;userid&#34;</span> : <span style=color:#b44>&#34;1003&#34;</span>, <span style=color:#b44>&#34;nickname&#34;</span> : <span style=color:#b44>&#34;凯撒&#34;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;5&#34;</span>, <span style=color:#b44>&#34;userid&#34;</span> : <span style=color:#b44>&#34;1003&#34;</span>, <span style=color:#b44>&#34;nickname&#34;</span> : <span style=color:#b44>&#34;凯撒&#34;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;3&#34;</span>, <span style=color:#b44>&#34;userid&#34;</span> : <span style=color:#b44>&#34;1004&#34;</span>, <span style=color:#b44>&#34;nickname&#34;</span> : <span style=color:#b44>&#34;杰克船长&#34;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;1&#34;</span>, <span style=color:#b44>&#34;userid&#34;</span> : <span style=color:#b44>&#34;1002&#34;</span>, <span style=color:#b44>&#34;nickname&#34;</span> : <span style=color:#b44>&#34;相忘于江湖&#34;</span> <span style=color:#666>}</span>
</code></pre></div><h3 id=复杂条件查询>复杂条件查询</h3>
<ul>
<li>正则表达式</li>
</ul>
<p>MongoDB的模糊查询是通过正则表达式的方式实现的。格式为：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.find<span style=color:#666>({</span>field:/正则表达式/<span style=color:#666>})</span>
或
db.集合.find<span style=color:#666>({</span>字段:/正则表达式/<span style=color:#666>})</span>
</code></pre></div><p>包含：/&mldr;/</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>({</span>content:/开水/<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;我夏天空腹喝凉开水，冬天喝温开水&#39;</span>,
  userid: <span style=color:#b44>&#39;1005&#39;</span>,
  nickname: <span style=color:#b44>&#39;伊人憔悴&#39;</span>,
  createdatetime: 2019-08-05T23:58:51.485Z,
  likenum: 888,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;我一直喝凉开水，冬天夏天都喝。&#39;</span>,
  userid: <span style=color:#b44>&#39;1004&#39;</span>,
  nickname: <span style=color:#b44>&#39;杰克船长&#39;</span>,
  createdatetime: 2019-08-06T01:05:06.321Z,
  likenum: 666,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>
</code></pre></div><p>^开头</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>({</span>content:/^我/<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&#39;</span>,
  userid: <span style=color:#b44>&#39;1002&#39;</span>,
  nickname: <span style=color:#b44>&#39;相忘于江湖&#39;</span>,
  createdatetime: 2019-08-05T22:08:15.522Z,
  likenum: 1000,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;我夏天空腹喝凉开水，冬天喝温开水&#39;</span>,
  userid: <span style=color:#b44>&#39;1005&#39;</span>,
  nickname: <span style=color:#b44>&#39;伊人憔悴&#39;</span>,
  createdatetime: 2019-08-05T23:58:51.485Z,
  likenum: 888,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;我一直喝凉开水，冬天夏天都喝。&#39;</span>,
  userid: <span style=color:#b44>&#39;1004&#39;</span>,
  nickname: <span style=color:#b44>&#39;杰克船长&#39;</span>,
  createdatetime: 2019-08-06T01:05:06.321Z,
  likenum: 666,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>

db.comment.find<span style=color:#666>({</span>content:/开水/<span style=color:#666>}</span>,<span style=color:#666>{</span>userid:1,nickname:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>, userid: <span style=color:#b44>&#39;1005&#39;</span>, nickname: <span style=color:#b44>&#39;伊人憔悴&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, userid: <span style=color:#b44>&#39;1004&#39;</span>, nickname: <span style=color:#b44>&#39;杰克船长&#39;</span> <span style=color:#666>}</span>
</code></pre></div><ul>
<li>包含查询
包含使用$in操作符。</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>({</span>userid:<span style=color:#666>{</span><span style=color:#b8860b>$in</span>:<span style=color:#666>[</span><span style=color:#b44>&#39;1003&#39;</span>,<span style=color:#b44>&#39;1004&#39;</span><span style=color:#666>]}})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;我一直喝凉开水，冬天夏天都喝。&#39;</span>,
  userid: <span style=color:#b44>&#39;1004&#39;</span>,
  nickname: <span style=color:#b44>&#39;杰克船长&#39;</span>,
  createdatetime: 2019-08-06T01:05:06.321Z,
  likenum: 666,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;4&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;专家说不能空腹吃饭，影响健康。&#39;</span>,
  userid: <span style=color:#b44>&#39;1003&#39;</span>,
  nickname: <span style=color:#b44>&#39;凯撒&#39;</span>,
  createdatetime: 2019-08-06T08:18:35.288Z,
  likenum: 2000,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;5&#39;</span>,
  articleid: <span style=color:#b44>&#39;100001&#39;</span>,
  content: <span style=color:#b44>&#39;研究表明，刚烧开的水千万不能喝，因为烫嘴。&#39;</span>,
  userid: <span style=color:#b44>&#39;1003&#39;</span>,
  nickname: <span style=color:#b44>&#39;凯撒&#39;</span>,
  createdatetime: 2019-08-06T11:01:02.521Z,
  likenum: 3000,
  state: <span style=color:#b44>&#39;1&#39;</span> <span style=color:#666>}</span>

db.comment.find<span style=color:#666>({</span>userid:<span style=color:#666>{</span><span style=color:#b8860b>$in</span>:<span style=color:#666>[</span><span style=color:#b44>&#39;1003&#39;</span>,<span style=color:#b44>&#39;1004&#39;</span><span style=color:#666>]}}</span>,<span style=color:#666>{</span>userid:1,nickname:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, userid: <span style=color:#b44>&#39;1004&#39;</span>, nickname: <span style=color:#b44>&#39;杰克船长&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;4&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, nickname: <span style=color:#b44>&#39;凯撒&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;5&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, nickname: <span style=color:#b44>&#39;凯撒&#39;</span> <span style=color:#666>}</span>
</code></pre></div><ul>
<li>条件连接查询</li>
</ul>
<p>$and,$or</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.find<span style=color:#666>({</span><span style=color:#b8860b>$and</span>:<span style=color:#666>[{</span>content:/开水/<span style=color:#666>}</span>,<span style=color:#666>{</span>userid:<span style=color:#b44>&#39;1004&#39;</span><span style=color:#666>}]}</span>,<span style=color:#666>{</span>userid:1,nickname:1,content:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>,
  content: <span style=color:#b44>&#39;我一直喝凉开水，冬天夏天都喝。&#39;</span>,
  userid: <span style=color:#b44>&#39;1004&#39;</span>,
  nickname: <span style=color:#b44>&#39;杰克船长&#39;</span> <span style=color:#666>}</span>
</code></pre></div><h3 id=更新>更新</h3>
<p>语法</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.update<span style=color:#666>(</span>query, update, options<span style=color:#666>)</span>
//或
db.collection.update<span style=color:#666>(</span>
&lt;query&gt;,
&lt;update&gt;,
<span style=color:#666>{</span>
upsert: &lt;boolean&gt;,
multi: &lt;boolean&gt;,
writeConcern: &lt;document&gt;,
collation: &lt;document&gt;,
arrayFilters: <span style=color:#666>[</span> &lt;filterdocument1&gt;, ... <span style=color:#666>]</span>,
hint: &lt;document|string&gt; // Available starting in MongoDB 4.2
<span style=color:#666>}</span>
<span style=color:#666>)</span>
</code></pre></div><table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>document</td>
<td>更新的选择条件。可以使用与find（）方法中相同的查询选择器，类似sql update查询内where后面的。。在3.0版中进行了更改：当使用upsert:true执行update（）时，如果查询使用点表示法在_id字段上指定条件，则MongoDB将拒绝插入新文档。</td>
</tr>
<tr>
<td>update</td>
<td>document or pipeline</td>
<td>要应用的修改。该值可以是：包含更新运算符表达式的文档，或仅包含：对的替换文档，或在MongoDB 4.2中启动聚合管道。管道可以由以下阶段组成：</td>
</tr>
<tr>
<td>upsert</td>
<td>boolean</td>
<td>可选。如果设置为true，则在没有与查询条件匹配的文档时创建新文档。默认值为false，如果找不到匹配项，则不会插入新文档。</td>
</tr>
<tr>
<td>multi</td>
<td>boolean</td>
<td>可选。如果设置为true，则更新符合查询条件的多个文档。如果设置为false，则更新一个文档。默认值为false。</td>
</tr>
<tr>
<td>writeConcern</td>
<td>document</td>
<td>可选。表示写问题的文档。抛出异常的级别。</td>
</tr>
<tr>
<td>collation</td>
<td>document</td>
<td>可选。指定要用于操作的校对规则。校对规则允许用户为字符串比较指定特定于语言的规则，例如字母大小写和重音标记的规则。校对规则选项具有以下语法：</td>
</tr>
<tr>
<td>校对规则：</td>
<td></td>
<td></td>
</tr>
<tr>
<td>{区域设置：，caseLevel:，caseFirst:，强度：，numericordering:，替代：，最大变量：，向后：}</td>
<td></td>
<td></td>
</tr>
<tr>
<td>指定校对规则时，区域设置字段是必需的；所有其他校对规则字段都是可选的。有关字段的说明，请参阅校对规则文档。如果未指定校对规则，但集合具有默认校对规则（请参见db.createCollection（）），则该操作将使用为集合指定的校对规则。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>如果没有为集合或操作指定校对规则，MongoDB将使用本中使用的简单二进制比较进行字符串比较。不能为一个操作指定多个校对规则。例如，不能为每个字段指定不同的校对规则，或者如果使用排序执行查找，则不能将一个校对规则用于查找，另一个校对规则用于排序。3.4版新增。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>arrayFilters</td>
<td>array</td>
<td>可选。一个筛选文档数组，用于确定要为数组字段上的更新操作修改哪些数组元素。</td>
</tr>
<tr>
<td>hint</td>
<td>Document or string</td>
<td>可选。指定用于支持查询谓词的索引的文档或字符串。该选项可以采用索引规范文档或索引名称字符串。如果指定的索引不存在，则说明操作错误。例如，请参阅版本4中的“为更新操作指定提示。</td>
</tr>
</tbody>
</table>
<ul>
<li>覆盖</li>
</ul>
<p>Mongodb Compass 5会对此报错</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.update<span style=color:#666>({</span>_id:<span style=color:#b44>&#34;1&#34;</span><span style=color:#666>}</span>,<span style=color:#666>{</span>likenum:NumberInt<span style=color:#666>(</span>1001<span style=color:#666>)})</span>

db.comment.update<span style=color:#666>({</span>_id:<span style=color:#b44>&#34;1&#34;</span><span style=color:#666>}</span>,<span style=color:#666>{</span>likenum:NumberInt<span style=color:#666>(</span>1001<span style=color:#666>)})</span>
MongoInvalidArgumentError: Update document requires atomic operators
......
</code></pre></div><p>atomic operators：</p>
<blockquote>
<p>$set
用来指定一个键并更新键值，若键不存在并创建。
{ $set : { field : value } }
$unset
用来删除一个键。
{ $unset : { field : 1} }
$inc
$inc可以对文档的某个值为数字型（只能为满足要求的数字）的键进行增减的操作。
{ $inc : { field : value } }
$push
{ $push : { field : value } }
把value追加到field里面去，field一定要是数组类型才行，如果field不存在，会新增一个数组类型加进去。
&mldr;&mldr;</p>
</blockquote>
<p>换到shell环境：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&gt; db.comment.update<span style=color:#666>({</span>likenum:888<span style=color:#666>}</span>,<span style=color:#666>{</span>userid:<span style=color:#b44>&#39;1009&#39;</span><span style=color:#666>})</span>
WriteResult<span style=color:#666>({</span> <span style=color:#b44>&#34;nMatched&#34;</span> : 1, <span style=color:#b44>&#34;nUpserted&#34;</span> : 0, <span style=color:#b44>&#34;nModified&#34;</span> : <span style=color:#666>1</span> <span style=color:#666>})</span>
&gt; db.comment.find<span style=color:#666>()</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;1&#34;</span>, <span style=color:#b44>&#34;articleid&#34;</span> : <span style=color:#b44>&#34;100001&#34;</span>, <span style=color:#b44>&#34;content&#34;</span> : <span style=color:#b44>&#34;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&#34;</span>, <span style=color:#b44>&#34;userid&#34;</span> : <span style=color:#b44>&#34;1002&#34;</span>, <span style=color:#b44>&#34;nickname&#34;</span> : <span style=color:#b44>&#34;相忘于江湖&#34;</span>, <span style=color:#b44>&#34;createdatetime&#34;</span> : ISODate<span style=color:#666>(</span><span style=color:#b44>&#34;2019-08-05T22:08:15.522Z&#34;</span><span style=color:#666>)</span>, <span style=color:#b44>&#34;likenum&#34;</span> : 1000, <span style=color:#b44>&#34;state&#34;</span> : <span style=color:#b44>&#34;1&#34;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;2&#34;</span>, <span style=color:#b44>&#34;userid&#34;</span> : <span style=color:#b44>&#34;1009&#34;</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> <span style=color:#b44>&#34;_id&#34;</span> : <span style=color:#b44>&#34;3&#34;</span>, <span style=color:#b44>&#34;articleid&#34;</span> : <span style=color:#b44>&#34;100001&#34;</span>, <span style=color:#b44>&#34;content&#34;</span> :
......
</code></pre></div><p>执行成功，但是，document中只有update的userid，其他都没有了，这是一种覆盖模式。</p>
<ul>
<li>$set局部修改</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.update<span style=color:#666>({</span>userid:<span style=color:#b44>&#39;1003&#39;</span><span style=color:#666>}</span>,<span style=color:#666>{</span><span style=color:#b8860b>$set</span>:<span style=color:#666>{</span>likenum:999<span style=color:#666>}})</span>
<span style=color:#666>{</span> acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: <span style=color:#666>0</span> <span style=color:#666>}</span>
db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>userid:1,likenum:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;0&#39;</span>, userid: <span style=color:#b44>&#39;1001&#39;</span>, likenum: <span style=color:#666>10</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>, userid: <span style=color:#b44>&#39;1002&#39;</span>, likenum: <span style=color:#666>1000</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>, userid: <span style=color:#b44>&#39;1100&#39;</span>, likenum: <span style=color:#666>888</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, userid: <span style=color:#b44>&#39;1004&#39;</span>, likenum: <span style=color:#666>666</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;4&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, likenum: <span style=color:#666>999</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;5&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, likenum: <span style=color:#666>3000</span> <span style=color:#666>}</span>
</code></pre></div><p>上面的例子userid：1003有两条，如果都要改，加上multi:true</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.update<span style=color:#666>({</span>userid:<span style=color:#b44>&#39;1003&#39;</span><span style=color:#666>}</span>,<span style=color:#666>{</span><span style=color:#b8860b>$set</span>:<span style=color:#666>{</span>likenum:777<span style=color:#666>}}</span>,<span style=color:#666>{</span>multi:true<span style=color:#666>})</span>
<span style=color:#666>{</span> acknowledged: true,
  insertedId: null,
  matchedCount: 2,
  modifiedCount: 2,
  upsertedCount: <span style=color:#666>0</span> <span style=color:#666>}</span>
db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>userid:1,likenum:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;0&#39;</span>, userid: <span style=color:#b44>&#39;1001&#39;</span>, likenum: <span style=color:#666>10</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>, userid: <span style=color:#b44>&#39;1002&#39;</span>, likenum: <span style=color:#666>1000</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>, userid: <span style=color:#b44>&#39;1100&#39;</span>, likenum: <span style=color:#666>888</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, userid: <span style=color:#b44>&#39;1004&#39;</span>, likenum: <span style=color:#666>666</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;4&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, likenum: <span style=color:#666>777</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;5&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, likenum: <span style=color:#666>777</span> <span style=color:#666>}</span>
</code></pre></div><ul>
<li>对某个值自增</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.update<span style=color:#666>({</span>userid:<span style=color:#b44>&#39;1001&#39;</span><span style=color:#666>}</span>,<span style=color:#666>{</span><span style=color:#b8860b>$inc</span>:<span style=color:#666>{</span>likenum:1<span style=color:#666>}})</span>
<span style=color:#666>{</span> acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: <span style=color:#666>0</span> <span style=color:#666>}</span>
db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>userid:1,likenum:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;0&#39;</span>, userid: <span style=color:#b44>&#39;1001&#39;</span>, likenum: <span style=color:#666>11</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>, userid: <span style=color:#b44>&#39;1002&#39;</span>, likenum: <span style=color:#666>1000</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>, userid: <span style=color:#b44>&#39;1100&#39;</span>, likenum: <span style=color:#666>888</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, userid: <span style=color:#b44>&#39;1004&#39;</span>, likenum: <span style=color:#666>666</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;4&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, likenum: <span style=color:#666>777</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;5&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, likenum: <span style=color:#666>777</span> <span style=color:#666>}</span>
</code></pre></div><h3 id=删除-1>删除</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.集合名称.remove<span style=color:#666>(</span>条件<span style=color:#666>)</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.remove<span style=color:#666>({</span>_id:<span style=color:#b44>&#39;4&#39;</span><span style=color:#666>})</span>
<span style=color:#b44>&#39;DeprecationWarning: Collection.remove() is deprecated. Use deleteOne, deleteMany, findOneAndDelete, or bulkWrite.&#39;</span>
<span style=color:#666>{</span> acknowledged: true, deletedCount: <span style=color:#666>1</span> <span style=color:#666>}</span>
db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>userid:1,likenum:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;0&#39;</span>, userid: <span style=color:#b44>&#39;1001&#39;</span>, likenum: <span style=color:#666>11</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>, userid: <span style=color:#b44>&#39;1002&#39;</span>, likenum: <span style=color:#666>1000</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>, userid: <span style=color:#b44>&#39;1100&#39;</span>, likenum: <span style=color:#666>888</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, userid: <span style=color:#b44>&#39;1004&#39;</span>, likenum: <span style=color:#666>666</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;5&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, likenum: <span style=color:#666>777</span> <span style=color:#666>}</span>
</code></pre></div><p>提示即将弃用，尝试新的命令</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.findOneAndDelete<span style=color:#666>({</span>_id:<span style=color:#b44>&#39;0&#39;</span><span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;0&#39;</span>,
  articleid: <span style=color:#b44>&#39;100000&#39;</span>,
  content: <span style=color:#b44>&#39;今天天气真好，阳光明媚&#39;</span>,
  userid: <span style=color:#b44>&#39;1001&#39;</span>,
  nickname: <span style=color:#b44>&#39;Rose&#39;</span>,
  createdatetime: 2022-01-21T12:57:49.081Z,
  likenum: 11,
  state: null <span style=color:#666>}</span>
db.comment.find<span style=color:#666>({}</span>,<span style=color:#666>{</span>userid:1,likenum:1<span style=color:#666>})</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;1&#39;</span>, userid: <span style=color:#b44>&#39;1002&#39;</span>, likenum: <span style=color:#666>1000</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;2&#39;</span>, userid: <span style=color:#b44>&#39;1100&#39;</span>, likenum: <span style=color:#666>888</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;3&#39;</span>, userid: <span style=color:#b44>&#39;1004&#39;</span>, likenum: <span style=color:#666>666</span> <span style=color:#666>}</span>
<span style=color:#666>{</span> _id: <span style=color:#b44>&#39;5&#39;</span>, userid: <span style=color:#b44>&#39;1003&#39;</span>, likenum: <span style=color:#666>777</span> <span style=color:#666>}</span>
</code></pre></div><h2 id=索引>索引</h2>
<p>如果查询存在适当的索引，MongoDB可以使用该索引限制必须检查的文档数。
索引是特殊的数据结构，它以易于遍历的形式存储集合数据集的一小部分。索引存储特定字段或一组字段的值，按字段值排序。索引项的排
序支持有效的相等匹配和基于范围的查询操作。此外，MongoDB还可以使用索引中的排序返回排序结果。</p>
<p>官网文档：
<a href=https://docs.mongodb.com/manual/indexes/>Indexes</a></p>
<p>MongoDB索引使用B树数据结构（确切的说是B-Tree，MySQL是B+Tree）</p>
<h3 id=索引的类型>索引的类型</h3>
<ul>
<li>单字段索引
MongoDB支持在文档的单个字段上创建用户定义的升序/降序索引，称为单字段索引（Single Field Index）。</li>
<li>复合索引
MongoDB还支持多个字段的用户定义索引，即复合索引（Compound Index）。</li>
<li>其他索引
地理空间索引（Geospatial Index）、文本索引（Text Indexes）、哈希索引（Hashed Indexes）。</li>
</ul>
<h3 id=索引的管理操作>索引的管理操作</h3>
<ul>
<li>索引的查看</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.getIndexes<span style=color:#666>()</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.getIndexes<span style=color:#666>()</span><span style=color:#080;font-style:italic>#默认索引</span>
<span style=color:#666>[</span> <span style=color:#666>{</span> v: 2, key: <span style=color:#666>{</span> _id: <span style=color:#666>1</span> <span style=color:#666>}</span>, name: <span style=color:#b44>&#39;_id_&#39;</span> <span style=color:#666>}</span> <span style=color:#666>]</span>
</code></pre></div><p>v-version</p>
<ul>
<li>在集合上创建索引</li>
</ul>
<p>（1）单字段索引</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.collection.createIndex<span style=color:#666>(</span>keys, options<span style=color:#666>)</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.createIndex<span style=color:#666>({</span>userid:1<span style=color:#666>})</span>
<span style=color:#b44>&#39;userid_1&#39;</span>
db.comment.getIndexes<span style=color:#666>()</span>
<span style=color:#666>[</span>
  <span style=color:#666>{</span> v: 2, key: <span style=color:#666>{</span> _id: <span style=color:#666>1</span> <span style=color:#666>}</span>, name: <span style=color:#b44>&#39;_id_&#39;</span> <span style=color:#666>}</span>,
  <span style=color:#666>{</span> v: 2, key: <span style=color:#666>{</span> userid: <span style=color:#666>1</span> <span style=color:#666>}</span>, name: <span style=color:#b44>&#39;userid_1&#39;</span> <span style=color:#666>}</span>
<span style=color:#666>]</span>
</code></pre></div><p>创建了userid的索引</p>
<p><strong>keys</strong> ：document
包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型。
对于字段上的升序索引，请指定值1；对于降序索引，请指定值-1。比如： {字段:1或-1} ，其中1 为指定按升序创建索引，如想按降序来创建索引指定为 -1 即可。
另外，MongoDB支持几种不同的索引类型，包括文本、地理空间和哈希索引。</p>
<p><strong>options</strong>列表：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>background</td>
<td>Boolean</td>
<td>建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加"background&rdquo; 可选参数。 &ldquo;background&rdquo; 默认值为false。</td>
</tr>
<tr>
<td>unique</td>
<td>Boolean</td>
<td>建立的索引是否唯一。指定为true创建唯一索引。默认值为false.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称。</td>
</tr>
<tr>
<td>sparse</td>
<td>Boolean</td>
<td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 false.</td>
</tr>
<tr>
<td>expireAfterSeconds</td>
<td>integer</td>
<td>指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间。</td>
</tr>
<tr>
<td>v</td>
<td>index version</td>
<td>索引的版本号。默认的索引版本取决于mongod创建索引时运行的版本。</td>
</tr>
<tr>
<td>weights</td>
<td>document</td>
<td>索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。</td>
</tr>
<tr>
<td>default_language</td>
<td>string</td>
<td>对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语</td>
</tr>
<tr>
<td>language_override</td>
<td>string</td>
<td>对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的language，默认值为language.</td>
</tr>
</tbody>
</table>
<p>（2）复合索引：对 userid 和 nickname 同时建立复合（Compound）索引：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.createIndex<span style=color:#666>({</span>nickname:1,userid:-1<span style=color:#666>})</span>
<span style=color:#b44>&#39;nickname_1_userid_-1&#39;</span>
db.comment.getIndexes<span style=color:#666>()</span>
<span style=color:#666>[</span>
  <span style=color:#666>{</span> v: 2, key: <span style=color:#666>{</span> _id: <span style=color:#666>1</span> <span style=color:#666>}</span>, name: <span style=color:#b44>&#39;_id_&#39;</span> <span style=color:#666>}</span>,
  <span style=color:#666>{</span> v: 2, key: <span style=color:#666>{</span> userid: <span style=color:#666>1</span> <span style=color:#666>}</span>, name: <span style=color:#b44>&#39;userid_1&#39;</span> <span style=color:#666>}</span>,
  <span style=color:#666>{</span>
    v: 2,
    key: <span style=color:#666>{</span> nickname: 1, userid: -1 <span style=color:#666>}</span>,
    name: <span style=color:#b44>&#39;nickname_1_userid_-1&#39;</span>
  <span style=color:#666>}</span>
<span style=color:#666>]</span>
</code></pre></div><p><img src=%E7%B4%A2%E5%BC%95%208e79e1a4a17b4e14936e0e4a34f8585d/Untitled.png alt=Untitled></p>
<ul>
<li>删除索引</li>
</ul>
<p>（1）删除某个索引</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.dropIndex<span style=color:#666>({</span>userid:1<span style=color:#666>})</span>  <span style=color:#080;font-style:italic>#按字段删除</span>
<span style=color:#666>{</span> nIndexesWas: 3, ok: <span style=color:#666>1</span> <span style=color:#666>}</span>

db.comment.getIndexes<span style=color:#666>()</span>
<span style=color:#666>[</span>
  <span style=color:#666>{</span> v: 2, key: <span style=color:#666>{</span> _id: <span style=color:#666>1</span> <span style=color:#666>}</span>, name: <span style=color:#b44>&#39;_id_&#39;</span> <span style=color:#666>}</span>,
  <span style=color:#666>{</span>
    v: 2,
    key: <span style=color:#666>{</span> nickname: 1, userid: -1 <span style=color:#666>}</span>,
    name: <span style=color:#b44>&#39;nickname_1_userid_-1&#39;</span>
  <span style=color:#666>}</span>
<span style=color:#666>]</span>

db.comment.dropIndex<span style=color:#666>(</span><span style=color:#b44>&#39;nickname_1_userid_-1&#39;</span><span style=color:#666>)</span><span style=color:#080;font-style:italic>#按名字删除，不使用{}</span>
<span style=color:#666>{</span> nIndexesWas: 2, ok: <span style=color:#666>1</span> <span style=color:#666>}</span>
</code></pre></div><p>（2）删除全部用户索引</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>db.comment.dropIndexes<span style=color:#666>()</span>
<span style=color:#666>{</span>
  nIndexesWas: 3,
  msg: <span style=color:#b44>&#39;non-_id indexes dropped for collection&#39;</span>,
  ok: <span style=color:#666>1</span>
<span style=color:#666>}</span>
db.comment.getIndexes<span style=color:#666>()</span>
<span style=color:#666>[</span> <span style=color:#666>{</span> v: 2, key: <span style=color:#666>{</span> _id: <span style=color:#666>1</span> <span style=color:#666>}</span>, name: <span style=color:#b44>&#39;_id_&#39;</span> <span style=color:#666>}</span> <span style=color:#666>]</span><span style=color:#080;font-style:italic>#系统索引不会被删除</span>
</code></pre></div><h3 id=索引的使用>索引的使用</h3>
<ul>
<li>执行计划
分析查询性能（Analyze Query Performance）通常使用执行计划（解释计划、Explain Plan）来查看查询的情况，如查询耗费的时间、是否基于索引查询等。
语法：</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>db.collection.find(query,<span style=color:#a2f;font-weight:700>options</span>).<span style=color:#a2f;font-weight:700>explain</span>(<span style=color:#a2f;font-weight:700>options</span>)<span style=color:#bbb>
</span></code></pre></div><p>示例：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>db.<span style=color:#a2f;font-weight:700>comment</span>.find(<span>{</span>userid:<span style=color:#b44>&#39;1003&#39;</span><span>}</span>).<span style=color:#a2f;font-weight:700>explain</span>()<span style=color:#bbb>
</span><span style=color:#bbb></span><span>{</span><span style=color:#bbb> </span>explainVersion:<span style=color:#bbb> </span><span style=color:#b44>&#39;1&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>queryPlanner:<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span>{</span><span style=color:#bbb> </span>namespace:<span style=color:#bbb> </span><span style=color:#b44>&#39;etaondb.comment&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>indexFilterSet:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>parsedQuery:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>userid:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span><span style=color:#b44>&#39;$eq&#39;</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;1003&#39;</span><span style=color:#bbb> </span><span>}</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>maxIndexedOrSolutionsReached:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>maxIndexedAndSolutionsReached:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>maxScansToExplodeReached:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>winningPlan:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span>{</span><span style=color:#bbb> </span>stage:<span style=color:#bbb> </span><span style=color:#b44>&#39;COLLSCAN&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>        </span>filter:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>userid:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span><span style=color:#b44>&#39;$eq&#39;</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;1003&#39;</span><span style=color:#bbb> </span><span>}</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>        </span>direction:<span style=color:#bbb> </span><span style=color:#b44>&#39;forward&#39;</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>rejectedPlans:<span style=color:#bbb> </span>[]<span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>command:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>find:<span style=color:#bbb> </span><span style=color:#b44>&#39;comment&#39;</span>,<span style=color:#bbb> </span>filter:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>userid:<span style=color:#bbb> </span><span style=color:#b44>&#39;1003&#39;</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb> </span><span style=color:#b44>&#39;$db&#39;</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;etaondb&#39;</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>serverInfo:<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span>{</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>host</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;Alma&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>port:<span style=color:#bbb> </span><span style=color:#666>27017</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#a2f;font-weight:700>version</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;5.0.5&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>gitVersion:<span style=color:#bbb> </span><span style=color:#b44>&#39;d65fd89df3fc039b5c55933c0f71d647a54510ae&#39;</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>serverParameters:<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span>{</span><span style=color:#bbb> </span>internalQueryFacetBufferSizeBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalQueryFacetMaxOutputDocSizeBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalLookupStageIntermediateDocumentMaxSizeBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalDocumentSourceGroupMaxMemoryBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalQueryMaxBlockingSortMemoryUsageBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalQueryProhibitBlockingMergeOnMongoS:<span style=color:#bbb> </span><span style=color:#666>0</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalQueryMaxAddToSetBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalDocumentSourceSetWindowFieldsMaxMemoryBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>ok:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span>}</span><span style=color:#bbb>
</span></code></pre></div><p>增加userid的index后：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>db.<span style=color:#a2f;font-weight:700>comment</span>.createIndex(<span>{</span>userid:<span style=color:#666>1</span><span>}</span>)<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#b44>&#39;userid_1&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb></span>db.<span style=color:#a2f;font-weight:700>comment</span>.find(<span>{</span>userid:<span style=color:#b44>&#39;1003&#39;</span><span>}</span>).<span style=color:#a2f;font-weight:700>explain</span>()<span style=color:#bbb>
</span><span style=color:#bbb></span><span>{</span><span style=color:#bbb> </span>explainVersion:<span style=color:#bbb> </span><span style=color:#b44>&#39;1&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>queryPlanner:<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span>{</span><span style=color:#bbb> </span>namespace:<span style=color:#bbb> </span><span style=color:#b44>&#39;etaondb.comment&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>indexFilterSet:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>parsedQuery:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>userid:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span><span style=color:#b44>&#39;$eq&#39;</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;1003&#39;</span><span style=color:#bbb> </span><span>}</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>maxIndexedOrSolutionsReached:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>maxIndexedAndSolutionsReached:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>maxScansToExplodeReached:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>winningPlan:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span>{</span><span style=color:#bbb> </span>stage:<span style=color:#bbb> </span><span style=color:#b44>&#39;FETCH&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>        </span>inputStage:<span style=color:#bbb>
</span><span style=color:#bbb>         </span><span>{</span><span style=color:#bbb> </span>stage:<span style=color:#bbb> </span><span style=color:#b44>&#39;IXSCAN&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>keyPattern:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>userid:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>indexName:<span style=color:#bbb> </span><span style=color:#b44>&#39;userid_1&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>isMultiKey:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>multiKeyPaths:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>userid:<span style=color:#bbb> </span>[]<span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>isUnique:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>isSparse:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>isPartial:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>indexVersion:<span style=color:#bbb> </span><span style=color:#666>2</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>direction:<span style=color:#bbb> </span><span style=color:#b44>&#39;forward&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>           </span>indexBounds:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>userid:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#39;[&#34;1003&#34;, &#34;1003&#34;]&#39;</span><span style=color:#bbb> </span>]<span style=color:#bbb> </span><span>}</span><span style=color:#bbb> </span><span>}</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>rejectedPlans:<span style=color:#bbb> </span>[]<span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>command:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>find:<span style=color:#bbb> </span><span style=color:#b44>&#39;comment&#39;</span>,<span style=color:#bbb> </span>filter:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>userid:<span style=color:#bbb> </span><span style=color:#b44>&#39;1003&#39;</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb> </span><span style=color:#b44>&#39;$db&#39;</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;etaondb&#39;</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>serverInfo:<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span>{</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>host</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;Alma&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>port:<span style=color:#bbb> </span><span style=color:#666>27017</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#a2f;font-weight:700>version</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;5.0.5&#39;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>gitVersion:<span style=color:#bbb> </span><span style=color:#b44>&#39;d65fd89df3fc039b5c55933c0f71d647a54510ae&#39;</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>serverParameters:<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span>{</span><span style=color:#bbb> </span>internalQueryFacetBufferSizeBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalQueryFacetMaxOutputDocSizeBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalLookupStageIntermediateDocumentMaxSizeBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalDocumentSourceGroupMaxMemoryBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalQueryMaxBlockingSortMemoryUsageBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalQueryProhibitBlockingMergeOnMongoS:<span style=color:#bbb> </span><span style=color:#666>0</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalQueryMaxAddToSetBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>     </span>internalDocumentSourceSetWindowFieldsMaxMemoryBytes:<span style=color:#bbb> </span><span style=color:#666>104857600</span><span style=color:#bbb> </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>  </span>ok:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span>}</span><span style=color:#bbb>
</span></code></pre></div><p>上面的例子可以看到查询方式的变化：</p>
<blockquote>
<p>winningPlan:
{ stage: &lsquo;COLLSCAN&rsquo;,
filter: { userid: { &lsquo;$eq&rsquo;: &lsquo;1003&rsquo; } },
变成：
winningPlan:
{ stage: &lsquo;FETCH&rsquo;,
inputStage:
{ stage: &lsquo;IXSCAN&rsquo;,
keyPattern: { userid: 1 },
indexName: &lsquo;userid_1&rsquo;,</p>
</blockquote>
<p><em>COLLSCAN表示全集扫描
FETCH抓取
IXSCAN扫描Index</em></p>
<p>从compass看：</p>
<p><img src=%E7%B4%A2%E5%BC%95%208e79e1a4a17b4e14936e0e4a34f8585d/Untitled%201.png alt=Untitled></p>
<p>Documents Examined:<strong>6
检查了6次，即所有6条docments</strong></p>
<p>而使用了index：userid后</p>
<p><img src=%E7%B4%A2%E5%BC%95%208e79e1a4a17b4e14936e0e4a34f8585d/Untitled%202.png alt=Untitled></p>
<p>检查次数变成了2，效率提高了；使用的方式和命令行的情况一致</p>
<ul>
<li>涵盖的查询
Covered Queries
当查询条件和查询的投影仅包含索引字段时，MongoDB直接从索引返回结果，而不扫描任何文档或将文档带入内存。 这些覆盖的查询可以非常有效。</li>
</ul>
<p>上面的例子进行查询</p>
<p><img src=%E7%B4%A2%E5%BC%95%208e79e1a4a17b4e14936e0e4a34f8585d/Untitled%203.png alt=Untitled></p>
<p>不查看_id，显示documents检查为0</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#666>&gt;</span><span style=color:#bbb> </span>db.<span style=color:#a2f;font-weight:700>comment</span>.find(<span>{</span>userid:<span style=color:#666>1</span>,_id:<span style=color:#666>0</span><span>}</span>).<span style=color:#a2f;font-weight:700>explain</span>()<span style=color:#bbb>
</span><span style=color:#bbb></span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#b44>&#34;explainVersion&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#b44>&#34;queryPlanner&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;namespace&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;etaondb.comment&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;indexFilterSet&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;parsedQuery&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                        </span><span style=color:#b44>&#34;$and&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span>[<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span><span style=color:#b44>&#34;_id&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                                </span><span style=color:#b44>&#34;$eq&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span><span>}</span><span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span><span style=color:#b44>&#34;userid&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                                </span><span style=color:#b44>&#34;$eq&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span><span>}</span><span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span>}</span><span style=color:#bbb>
</span><span style=color:#bbb>                        </span>]<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;queryHash&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;B3109953&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;planCacheKey&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;349BB72E&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;maxIndexedOrSolutionsReached&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;maxIndexedAndSolutionsReached&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;maxScansToExplodeReached&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;winningPlan&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                        </span><span style=color:#b44>&#34;stage&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;FETCH&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                        </span><span style=color:#b44>&#34;filter&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;userid&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span><span style=color:#b44>&#34;$eq&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span>}</span><span style=color:#bbb>
</span><span style=color:#bbb>                        </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                        </span><span style=color:#b44>&#34;inputStage&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;stage&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;IXSCAN&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;keyPattern&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span><span style=color:#b44>&#34;_id&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;indexName&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;_id_&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;isMultiKey&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;multiKeyPaths&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span><span style=color:#b44>&#34;_id&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span>]<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;isUnique&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;isSparse&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;isPartial&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;indexVersion&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>2</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;direction&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;forward&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span style=color:#b44>&#34;indexBounds&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span><span style=color:#b44>&#34;_id&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span>[<span style=color:#bbb>
</span><span style=color:#bbb>                                                </span><span style=color:#b44>&#34;[0.0, 0.0]&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>                                        </span>]<span style=color:#bbb>
</span><span style=color:#bbb>                                </span><span>}</span><span style=color:#bbb>
</span><span style=color:#bbb>                        </span><span>}</span><span style=color:#bbb>
</span><span style=color:#bbb>                </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;rejectedPlans&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span>]<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#b44>&#34;command&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;find&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;comment&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;filter&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                        </span><span style=color:#b44>&#34;userid&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>1</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                        </span><span style=color:#b44>&#34;_id&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span><span style=color:#bbb>                </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;$db&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;etaondb&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#b44>&#34;serverInfo&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;host&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Alma&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;port&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>27017</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;version&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;5.0.5&#34;</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;gitVersion&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;d65fd89df3fc039b5c55933c0f71d647a54510ae&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#b44>&#34;serverParameters&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span>{</span><span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;internalQueryFacetBufferSizeBytes&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;internalQueryFacetMaxOutputDocSizeBytes&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;internalLookupStageIntermediateDocumentMaxSizeBytes&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;internalDocumentSourceGroupMaxMemoryBytes&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;internalQueryMaxBlockingSortMemoryUsageBytes&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;internalQueryProhibitBlockingMergeOnMongoS&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>0</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;internalQueryMaxAddToSetBytes&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>104857600</span>,<span style=color:#bbb>
</span><span style=color:#bbb>                </span><span style=color:#b44>&#34;internalDocumentSourceSetWindowFieldsMaxMemoryBytes&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>104857600</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span>}</span>,<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#b44>&#34;ok&#34;</span><span style=color:#bbb> </span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span>}</span><span style=color:#bbb>
</span></code></pre></div>
</div>
<footer class=post-footer>
<div id=wcomments></div>
</footer>
</article>
</section>
</div>
</div>
<div class=sidebar-toggle>
<div class=sidebar-toggle-line-wrap>
<span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
</div>
</div>
<aside id=sidebar class=sidebar>
<div class=sidebar-inner>
<ul class="sidebar-nav motion-element">
<li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>
文章目录
</li>
<li class=sidebar-nav-overview data-target=site-overview>
站点概览
</li>
</ul>
<section class="site-overview sidebar-panel">
<div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person>
<img class=site-author-image itemprop=image src=/img/avatar.png alt=Etaon>
<p class=site-author-name itemprop=name>Etaon</p>
<p class="site-description motion-element" itemprop=description>
Kepp Going!
</p>
</div>
<nav class="site-state motion-element">
<div class="site-state-item site-state-posts">
<a href=/post/>
<span class=site-state-item-count>61</span>
<span class=site-state-item-name>日志</span>
</a>
</div>
<div class="site-state-item site-state-categories">
<a href=/categories/>
<span class=site-state-item-count>13</span>
<span class=site-state-item-name>分类</span>
</a>
</div>
<div class="site-state-item site-state-tags">
<a href=/tags/>
<span class=site-state-item-count>34</span>
<span class=site-state-item-name>标签</span>
</a>
</div>
</nav>
<div class="links-of-author motion-element">
<span class=links-of-author-item>
<a href=https://github.com/etaon target=_blank title=GitHub>
<i class="fa fa-fw fa-github"></i>
GitHub
</a>
</span>
<span class=links-of-author-item>
<a href=https://blog.csdn.net/weixin_43394724 target=_blank title=CSDN>
<i class="fa fa-fw fa-CSDN"></i>
CSDN
</a>
</span>
</div>
<div class="links-of-blogroll motion-element links-of-blogroll-inline">
<div class=links-of-blogroll-title>
<i class="fa fa-fw fa-globe"></i>
友情链接
</div>
<ul class=links-of-blogroll-list>
<li class=links-of-blogroll-item>
<a href=https://kubernetes.io/ title=Kubernetes target=_blank>Kubernetes</a>
</li>
<li class=links-of-blogroll-item>
<a href=https://cisco.com/ title=Cisco target=_blank>Cisco</a>
</li>
<li class=links-of-blogroll-item>
<a href=https://www.w3school.com.cn/ title=W3School target=_blank>W3School</a>
</li>
<li class=links-of-blogroll-item>
<a href=https://www.liaoxuefeng.com/ title=廖雪峰 target=_blank>廖雪峰</a>
</li>
</ul>
</div>
<div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline">
<div class=tagcloud-of-blogroll-title>
<i class="fa fa-fw fa-tags"></i>
标签云
</div>
<ul class=tagcloud-of-blogroll-list>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/mysql>Mysql</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/aws>Aws</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/dql>Dql</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/hadoop>Hadoop</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/redis>Redis</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/cicd>Cicd</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/git>Git</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/istio>Istio</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/mongodb>Mongodb</a>
</li>
<li class=tagcloud-of-blogroll-item>
<a href=/tags/azure>Azure</a>
</li>
</ul>
</div>
</section>
<section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
<div class=post-toc>
<div class=post-toc-content><nav id=TableOfContents>
<ul>
<li><a href=#数据库操作>数据库操作</a>
<ul>
<li><a href=#创建>创建</a></li>
<li><a href=#查看>查看</a></li>
<li><a href=#删除>删除</a></li>
</ul>
</li>
<li><a href=#集合操作>集合操作</a>
<ul>
<li><a href=#集合创建>集合创建</a></li>
<li><a href=#删除集合>删除集合</a></li>
</ul>
</li>
<li><a href=#文档document的操作>文档（document）的操作</a>
<ul>
<li><a href=#插入>插入</a></li>
<li><a href=#查询>查询</a></li>
<li><a href=#复杂条件查询>复杂条件查询</a></li>
<li><a href=#更新>更新</a></li>
<li><a href=#删除-1>删除</a></li>
</ul>
</li>
<li><a href=#索引>索引</a>
<ul>
<li><a href=#索引的类型>索引的类型</a></li>
<li><a href=#索引的管理操作>索引的管理操作</a></li>
<li><a href=#索引的使用>索引的使用</a></li>
</ul>
</li>
</ul>
</nav></div>
</div>
</section>
</div>
</aside>
</div>
</main>
<footer id=footer class=footer>
<div class=footer-inner>
<div class=copyright>
<span class=copyright-year>
&copy; 2010 - 2022
</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>路无止境！</span>
</div>
<div class=powered-info>
<span class=powered-by>
Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.91.2</a>
</span>
<span class=separator-line>/</span>
<span class=theme-info>
Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank> NexT
</a>
</span>
</div>
<div class=vistor-info>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span class=site-uv>
<i class="fa fa-user"></i>
<span class=busuanzi-value id=busuanzi_value_site_uv></span>
</span>
<span class=separator-line>/</span>
<span class=site-pv>
<i class="fa fa-eye"></i>
<span class=busuanzi-value id=busuanzi_value_site_pv></span>
</span>
</div>
<div class=license-info>
<span class=storage-info>
Storage by
<a href=https://www.azure.com/ style=font-weight:700 target=_blank>Azure static web apps</a>
</span>
<span class=separator-line>/</span>
<span class=license-num>
<a href target=_blank></a>
</span>
</div>
</div>
</footer>
<div class=back-to-top>
<i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span>
</div>
</div>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var a=window.navigator.userAgent,b=a.indexOf('MSIE '),c=a.indexOf('Trident/'),d=a.indexOf('Edge/');return b>0||c>0||d>0?-1:1}function getCntViewHeight(){var b=$('#content').height(),a=$(window).height(),c=b>a?b-a:$(document).height()-a;return c}function getScrollbarWidth(){var a=$('<div />').addClass('scrollbar-measure').prependTo('body'),b=a[0],c=b.offsetWidth-b.clientWidth;return a.remove(),c}function registerBackTop(){var b=50,a=$('.back-to-top');$(window).on('scroll',function(){var d,e,f,c,g;a.toggleClass('back-to-top-on',window.pageYOffset>b),d=$(window).scrollTop(),e=getCntViewHeight(),f=d/e,c=Math.round(f*100),g=c>100?100:c,$('#scrollpercent>span').html(g)}),a.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var a='.post-toc',d=$(a),b='.active-current';d.on('activate.bs.scrollspy',function(){var b=$(a+' .active').last();c(),b.addClass('active-current')}).on('clear.bs.scrollspy',c),$('body').scrollspy({target:a});function c(){$(a+' '+b).removeClass(b.substring(1))}}function initAffix(){var a=$('.header-inner').height(),b=parseInt($('.main').css('padding-bottom'),10),c=a+10;$('.sidebar-inner').affix({offset:{top:c,bottom:b}}),$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){var a,b;$(window).on('resize',function(){a&&clearTimeout(a),a=setTimeout(function(){var a=document.body.clientHeight-100;updateTOCHeight(a)},0)}),updateTOCHeight(document.body.clientHeight-100),b=getScrollbarWidth(),$('.post-toc').css('width','calc(100% + '+b+'px)')}function updateTOCHeight(a){a=a||'auto',$('.post-toc').css('max-height',a)}$(function(){var b=$('.header-inner').height()+10,c,d,a,e;$('#sidebar').css({'margin-top':b}).show(),c=parseInt($('#sidebar').css('margin-top')),d=parseInt($('.sidebar-inner').css('height')),a=c+d,e=$('.content-wrap').height(),e<a&&$('.content-wrap').css('min-height',a),$('.site-nav-toggle').on('click',function(){var a=$('.site-nav'),e=$('.toggle'),b='site-nav-on',f='toggle-close',c=a.hasClass(b),g=c?'slideUp':'slideDown',d=c?'removeClass':'addClass';a.stop()[g]('normal',function(){a[d](b),e[d](f)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active'),$(this).next().removeClass('sidebar-nav-active'),$('.'+$(this).next().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)}),$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active'),$(this).prev().removeClass('sidebar-nav-active'),$('.'+$(this).prev().attr('data-target')).toggle(500),$('.'+$(this).attr('data-target')).toggle(500)})})</script>
<script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$('.post-body').viewer()})</script>
<script type=text/javascript>$(function(){detectIE()>0?$.getScript(document.location.protocol+'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js',function(){new Waline({el:'#wcomments',visitor:!0,avatar:'wavatar',avatarCDN:'https://sdn.geekzu.org/avatar/',avatarForce:!1,wordLimit:'200',placeholder:' 欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^ ',requiredFields:['nick','mail'],serverURL:"Your WalineSerURL",lang:"zh-cn"})}):$('#wcomments').html('抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。')})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script>
<script>(function(){var a=document.createElement('script'),c=window.location.protocol.split(':')[0],b;c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>