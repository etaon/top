<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>VMware虚拟网络-NSX架构篇（2） - 路无止境！</title><meta name=keywords content="博客,架构师,思考,读书,笔记,技术,分享,云"><meta name=author content="Etaon"><meta property="og:title" content="VMware虚拟网络-NSX架构篇（2）"><meta property="og:site_name" content="路无止境！"><meta property="og:image" content="/img/author.jpg"><meta name=title content="VMware虚拟网络-NSX架构篇（2） - 路无止境！"><meta name=description content="欢迎来到ETAON空间站，个人主要专注于Infra系统架构，私有/公有云产品，售前及微服务解决方案。"><link rel="shortcut icon" href=/img/favicon.ico><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet><link href=/css/main.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><div class=multi-lang-switch><i class="fa fa-fw fa-language" style=margin-right:5px></i>
<a class=lang-link id=zh-cn href=#>学习</a></div><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>路无止境！</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>没有伞的孩子要学会努力奔跑!</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class=menu-item><a href=/404.html rel=section><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline" style=font-weight:700><a class=post-title-link href=https://www.etaon.top/2021/11/30/nsx02.html itemprop=url>VMware虚拟网络-NSX架构篇（2）</a></h1></header><div class=post-body itemprop=articleBody><p>上回说到NSX-T manager的安装，成功导入ova文件以后，我们在vCenter上面可以看到NSX manager的虚机。
开机后，使用</p><p><strong><a href=https://ip/>https://ip</a></strong></p><p>便可以登录到管理界面了。</p><p><img src="https://img-blog.csdnimg.cn/20210513101323832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513101323832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><h3 id=查看manager实例>查看Manager实例</h3><p>导航到System&ndash;>Appliance，可以看到现在运行的控制节点实例，系统建议使用三台实例做成集群，实验中，我们只使用一台。</p><p><img src="https://img-blog.csdnimg.cn/2021051311364614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/2021051311364614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><h3 id=云网解耦物理网>云网解耦物理网</h3><p>先不急着往下，我们看看在基于软件的SDN最初是要解决什么问题，下图是在很多企业至今使用的架构</p><p><img src="https://img-blog.csdnimg.cn/20210513101553697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513101553697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>物理服务器已经虚拟化，企业大量使用虚机。为了解决服务器内部虚机的联网，使用了vss或vDS虚拟交换机。</p><p>但是，虚机的网关还是在物理交换机上，云内网络和物理网络是紧耦合关系。</p><p>硬件网络SDN出现以后，可以通过controller与vCenter的API沟通来获取和配置vDS。因为不是直接获取云网的信息，这样做的复杂性很高收益很小，对云网中的网络构建、维护等并没有什么优势，更不用说自动化、敏捷以及对容器的支持。</p><p>NSX-T 将全面接管虚拟云网，将虚拟网关下移到云网内部，实现云网和物理网的完全解耦。</p><p>但是，云网无论如何还在需要物理网络来承载，物理网络以及由了一套完善的技术堆栈。要想与其完全解耦，采用Overlay的方式是比较好的选择。</p><p>在Overlay的方式上，NSX-T选择了GENEVE。</p><p><img src="https://img-blog.csdnimg.cn/20210513105340556.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513105340556.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p><em>Geneve（Generic Network Virtualization Encapsulation，RFC Draft）是NVo3工作组对VxLAN、NvGRE和STT进行总结后提出的一种网络虚拟化技术，希望形成一种通用的封装格式，以便支持数据中心中隧道机制的后续演化。</em></p><p><em>Geneve封装的是以太网帧，外层的报头可以为IPv4也可以为IPv6。UDP Src Port常通过哈希获得，可用于ECMP；Dst Port为IANA分配给Geneve的6081。对于UDP Checksum，Geneve与VxLAN的处理办法相同，并建议使用NIC去做卸载。</em></p><p><em>Geneve Header中的O位为OAM标识，当O位置1的时候，Geneve携带的为控制信令而非Ethernet payload，VNI为24位的租户标识。Geneve Header还提供了TLV格式的Options，以支持后续的功能扩展。</em></p><p>通过NSX作用后，解耦合之后的网络虚拟化拓扑图</p><p><img src="https://img-blog.csdnimg.cn/2021051310550844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/2021051310550844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>NSX-T推送N-VDS或使用vDS（vSphere7+，NSX-T3.0+），构建一个一定物理主机集合范围内的大虚拟交换域，使用Logical Segment替代vlan或portgroup为虚机提供透明二层接入。</p><p>Overlay的Vtep点，就存在于每台主机的N-VDS/vDS上。</p><p>回到我们的实验。</p><h3 id=配置transport-zones>配置Transport Zones</h3><p>传输区域确定哪些主机可以参与使用特定的网络，进而确定哪些虚拟机可以参与使用该网络。传输区域限制可以“看到”某个逻辑交换机的主机（从而限制可以连接到该逻辑交换机的虚拟机）以实现该目的。传输区域可以跨一个或多个主机集群。</p><p>传输区域可以配置为Overlay和VLAN两种，这样就区分了流量是否通过VTEP点来加GENEVE包头。</p><p>另一个需要重点注意的是，由于Overlay需要加包头，所以传统以太包1500字节将超过，一般将涉及的交换机（物理或虚拟）的MTU设置为1600+，在实验中我们设置为8900.</p><p><img src="https://img-blog.csdnimg.cn/20210513111613483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513111613483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>导航到System&ndash;>Fabric&ndash;>Transport Zones
可以看到系统已经配置了两个默认的传输区域，分别是Overlay和VLAN的。
我们再配置两个以供使用：</p><p><img src="https://img-blog.csdnimg.cn/20210513112004690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513112004690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p><img src="https://img-blog.csdnimg.cn/20210513112051449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513112051449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><h3 id=绑定vcenter>绑定vCenter</h3><p>NSX-T与vSphere配合的环境中，最好绑定vCenter，简化很多操作
System&ndash;>Fabric&ndash;>Compute Manager</p><p><img src="https://img-blog.csdnimg.cn/20210513113130348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513113130348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>注意：如果需要在vSphere上面开启Tanzu 容器范围，务必要打开Trust和Create Service Account。</p><h3 id=主机准备>主机准备</h3><p>在这个过程里，我们将在主机上安装逻辑交换机，并将逻辑交换机和传输区域结合起来；同时，控制平面的LCP等组件也会安装到主机。</p><h3 id=为vtep建ip-pool>为VTEP建IP Pool</h3><p><img src="https://img-blog.csdnimg.cn/20210513114656430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513114656430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p><img src="https://img-blog.csdnimg.cn/20210513114717348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513114717348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><h3 id=利用计算集群做主机准备>利用计算集群做主机准备</h3><p>导航到System&ndash;>Fabric&ndash;>Nodes</p><p><img src="https://img-blog.csdnimg.cn/20210513115023230.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513115023230.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>注意：点击Managed by，找到上一个步骤加入的vCenter。</p><p><img src="https://img-blog.csdnimg.cn/20210513115542129.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513115542129.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>勾选需要作用的主机集群，然后开始CONFIGURE NSX，配置主机准备是使用配置文件的，我们新建一个</p><p><img src="https://img-blog.csdnimg.cn/20210513115654163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513115654163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p><img src="https://img-blog.csdnimg.cn/20210513121854937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513121854937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>Name：按照需要取
可以选择使用N-VDS还是VDS，我们选择VDS，便需要在已经配置好的vCenter选择vDS，此vDS为新建，且已经在主机上分配了出口物理端口。
选择要匹配的Transport Zone，我们选前面配置的tz-overlay</p><p><img src="https://img-blog.csdnimg.cn/20210513122226855.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513122226855.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>对于上联配置文件，我们新建一个单上联的，这个是和物理端口的分配有关</p><p><img src="https://img-blog.csdnimg.cn/20210513122159710.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513122159710.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>完成以后回到NSX Installation，点击apply</p><p><img src="https://img-blog.csdnimg.cn/20210513122401249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513122401249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>做好主机准备的ESXi是下图这个样子：</p><p><img src="https://img-blog.csdnimg.cn/2021051312532983.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/2021051312532983.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center"></p><p>从管理界面是这样的：</p><p><img src="https://img-blog.csdnimg.cn/20210513135204734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513135204734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>对于vSphere环境，架构准备工作完成。</p><h2 id=检查主机准备>检查主机准备</h2><p>我们做好了主机准备，整个过程系统是对我们屏蔽了细节的，那么，在ESXi上到底安装了些什么呢？</p><h3 id=vib信息>VIB信息</h3><p>可以登录到ESXi上面看看（ESXi可以在controller上打开SSH）
使用esxcli software vib list | grep nsx</p><p><img src="https://img-blog.csdnimg.cn/20210513173810266.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513173810266.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>里面的vib内容如下：</p><ul><li>nsx-adf
（自动诊断框架）收集并分析性能数据，以生成对性能问题的本地（主机）和中心（跨数据中心）诊断。</li><li>nsx-mpa
在 NSX Manager 和管理程序主机之间提供通信。</li></ul><p>更多详细解释参考：
<a href=https://docs.vmware.com/cn/VMware-NSX-T-Data-Center/3.1/installation/GUID-BC17F982-93FC-4D8B-8A06-09E5CA637EE7.html>在 ESXi 管理程序上手动安装 NSX-T Data Center 内核模块</a></p><h3 id=geneve-状态>GENEVE 状态</h3><p>使用net-vdl2 -l命令查看VTEP 和VNI的信息</p><p><img src="https://img-blog.csdnimg.cn/20210513174552316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513174552316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>我们可以看到在ESXi上打开的UPD端口：
VXLAN：4789
GENEVE：6081查看VTEP端口信息：esxcfg-vmknic -l</p><p><img src=https://img-blog.csdnimg.cn/20210513175730341.png alt=https://img-blog.csdnimg.cn/20210513175730341.png></p><p>这里可以看到vmk10还是VXLAN
其实这里改成GENEVE比较合适
从NSX-T 2.0以来就没有改过，可能是研发人忘了，毕竟也没啥人看，不影响使用</p><h2 id=传输节点-edge>传输节点-Edge</h2><p>在上面我们提到了Edge：</p><ul><li>Edge节点：VMware NSX Edge节点是专用于运行无法分发到管理程序的网络服务的服务设备。它们被分组在一个或多个集群中，代表一个<strong>能力池</strong>。</li></ul><p>Edge不是一个干活的实例，它是个池。里面专门用来放虚拟的路由设备T0和T1，有了Edge，NSX-T的路由和服务功能才能实现。</p><p><strong>几个注意点：</strong></p><ol><li>每个 NSX Edge 节点只能具有一个 Tier-0 路由器。不过，可以在一个 NSX Edge 节点上托管多个 Tier-1 逻辑路由器</li><li>Edge Cluster最多包含10个Edge节点（NSX-T 3.0）</li><li>Edge节点可以是虚机或者裸机版本</li></ol><p>那T0和T1路由器又是什么呢？</p><h3 id=逻辑路由器>逻辑路由器</h3><p><em>Tier-0 逻辑路由器
Tier-0 逻辑路由器提供南北向连接，并连接到物理路由器。可以将其配置为活动-活动或活动-备用集群。Tier-0 网关运行 BGP 并作为物理路由器的对等项。在活动-备用模式下，该网关还可以提供有状态服务。
Tier-1 逻辑路由器
Tier-1 逻辑路由器连接到一个 Tier-0 逻辑路由器，以提供到与其相连的子网的北向连接。它连接到一个或多个覆盖网络，以提供到其子网的南向连接。可以将 Tier-1 逻辑路由器配置为活动-备用集群。</em></p><p>原来，这是NSX-T提供两层次路由设备。
T0提供整体南北出口，而T1必须连接到T0，提供子网的南向连接。</p><p>那么，逻辑路由器又是由什么组成的呢？</p><p><img src="https://img-blog.csdnimg.cn/20210513185918155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513185918155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>逻辑路由器由两个组件构成：
DR：负责东西向路由转发
SR：负责南北向路由转发和如NAT、LB等有状态的集中服务</p><h3 id=逻辑路由器和edge的关系>逻辑路由器和Edge的关系</h3><p>正如刚才说的，逻辑路由器存在于Edge中，但是，它也不仅仅是存在于Edge中。</p><p><img src="https://img-blog.csdnimg.cn/20210513190347833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513190347833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>上图给出了逻辑路由器、edge以及主机之间的关系。</p><ul><li>在首次部署 NSX Edge 时，可以将其视为空容器。在创建逻辑路由器后，NSX Edge 才会执行任何操作。</li><li>NSX Edge 为Tier-0 和 Tier-1 逻辑路由器提供计算支持。每个逻辑路由器包含一个服务路由器 (SR) 和一个分布式路由器 (DR)。</li><li>在我们谈到路由器是分布式路由器时，是指在属于同一传输区域的所有传输节点上复制该路由器。</li><li>在上图中，主机传输节点可以包含在 Tier-0 和Tier-1 路由器上包含的同一 DR。</li><li>如果要配置逻辑路由器以执行服务（如 NAT），则需要使用服务路由器。</li><li>所有 Tier-0逻辑路由器都具有服务路由器。</li><li>默认情况下，SR 和 DR 之间的链路使用 169.254.0.0/28 子网。在部署 Tier-0 或 Tier-1 逻辑路由器时，将自动创建这些路由器内中转链路。</li><li>为 Tier-0 到 Tier-1 的连接分配的默认地址空间为 100.64.0.0/10。将在 100.64.0.0/10 地址空间中为每个 Tier-0 到 Tier-1 的对等连接提供一个 /31 子网。在创建 Tier-1 路由器并将其连接到 Tier-0 路由器时，将自动创建该链路。</li></ul><p>在具体使用上存在以下场景：</p><ol><li>仅仅只有T0路由器的单层结构
这个情况下，逻辑分段直接连接到T0路由器</li></ol><table><thead><tr><th>Routertire</th><th>Edge</th><th>H/V</th></tr></thead><tbody><tr><td>T0 SR</td><td>‣</td><td></td></tr><tr><td>T0 DR</td><td>‣</td><td>‣</td></tr></tbody></table><p><img src="https://img-blog.csdnimg.cn/20210513201445501.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/20210513201445501.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center"></p><ol><li>T0/T1两层结构，T1不起服务</li></ol><table><thead><tr><th>Routertire</th><th>Edge</th><th>H/V</th></tr></thead><tbody><tr><td>T0 SR</td><td>‣</td><td></td></tr><tr><td>T0 DR</td><td>‣</td><td>‣</td></tr><tr><td>T1 DR</td><td>‣</td><td>‣</td></tr></tbody></table><p><img src="https://img-blog.csdnimg.cn/20210513201459252.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/20210513201459252.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center"></p><p>这个拓扑里，进出流量的路径是不一样的。</p><ol><li>T0/T1两层结构，T1起NAT等服务</li></ol><table><thead><tr><th>Routertire</th><th>Edge</th><th>H/V</th></tr></thead><tbody><tr><td>T0 SR</td><td>‣</td><td></td></tr><tr><td>T0 DR</td><td>‣</td><td></td></tr><tr><td>T1 SR</td><td>‣</td><td></td></tr><tr><td>T1 DR</td><td>‣</td><td>‣</td></tr></tbody></table><p><img src="https://img-blog.csdnimg.cn/20210513201514439.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/20210513201514439.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center"></p><h3 id=edge类型>Edge类型</h3><p>Edge在部署时，可以选择两种类型：</p><ul><li><p>虚拟设备/虚拟机 NSX Edge
在将 NSX Edge 安装为虚拟设备或虚拟机时，将创建名为 fp-ethX 的内部接口，其中 X 为 0、1、2 和 3。将为到 交换机的上行链路和 NSX-T Data Center 覆盖网络隧道分配这些接口。
NSX Edge 将连接到虚拟交换机上，如vSphere环境将连接到VSS/VDS。必须为 NSX Edge 分配至少三个 vmnic：用于 NSX Edge 管理，上行链路和隧道。</p><p><img src="https://img-blog.csdnimg.cn/20210513202906771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513202906771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p></li><li><p>裸机 NSX Edge
裸机 NSX Edge 包含名为 fp-ethX 的内部接口，其中 X 最多为 16 个接口。创建的 fp-ethX 接口数取决于裸机 NSX Edge 具有多少个物理网卡。最多可以为到架顶式 (ToR) 交换机和 NSX-T Data Center 覆盖网络隧道的上行链路分配其中的 4 个接口。
<strong>我们在实验中选择虚机Edge</strong></p><p><img src="https://img-blog.csdnimg.cn/20210513203108737.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513203108737.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p></li></ul><h3 id=部署vm-edge>部署VM Edge</h3><p>导航到System&ndash;>Fabric&ndash;>Nodes&ndash;>Edge Transport Nodes&ndash;>+ADD EDGE NODE</p><p><img src="https://img-blog.csdnimg.cn/20210513211650825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513211650825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p><img src="https://img-blog.csdnimg.cn/20210516193611728.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516193611728.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>系统第一步会让我们选择edge的大小规格：</p><table><thead><tr><th>设备大小</th><th>内存</th><th>vCPU</th><th>磁盘空间</th><th>虚拟机硬件版本</th><th>备注</th></tr></thead><tbody><tr><td>NSX Edge 小型</td><td>4 GB</td><td>2</td><td>200 GB</td><td>11 或更高版本（vSphere 6.0 或更高版本）</td><td>仅概念验证部署。注：如果部署小型 NSX Edge 虚拟机，则不会在 Tier-1 网关上实现 L7 规则。</td></tr><tr><td>NSX Edge 中型</td><td>8 GB</td><td>4</td><td>200 GB</td><td>11 或更高版本（vSphere 6.0 或更高版本）</td><td>在仅需要使用 L2 至 L4 功能（例如 NAT、路由、L4 防火墙、L4 负载均衡器）并且总吞吐量要求小于 2 Gbps 时适用。</td></tr><tr><td>NSX Edge 大型</td><td>32 GB</td><td>8</td><td>200 GB</td><td>11 或更高版本（vSphere 6.0 或更高版本）</td><td>在仅需要使用 L2 至 L4 功能（例如 NAT、路由、L4 防火墙、L4 负载均衡器）并且总吞吐量为 2-10 Gbps 时适用。在需要使用 L7 负载均衡器（例如，SSL 卸载）时，它也适用。</td></tr><tr><td>NSX Edge 超大型</td><td>64 GB</td><td>16</td><td>200 GB</td><td>11 或更高版本（vSphere 6.0 或更高版本）</td><td>在 L7 负载均衡器和 VPN 所需的总吞吐量为多个 Gbps 时适用。</td></tr></tbody></table><p>从上表中考虑，我们选用大型版本。</p><p><img src="https://img-blog.csdnimg.cn/20210513202906771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210513202906771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>再来看看VM Edge的架构图，单独的VM Edge至少配置** 三个 vmnic：用于 NSX Edge 管理，上行链路和Overlay隧道。 **同时，VM Edge需要部署两台虚拟N-VDS：Overlay和VLAN。</p><p><img src="https://img-blog.csdnimg.cn/20210516193654256.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516193654256.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>为了方便登录Edge做debug和验证，我们把SSH打开。</p><p><img src="https://img-blog.csdnimg.cn/20210516193919912.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516193919912.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>我们选定主机作为宿主。
在实际的项目中，如果不用裸机Edge，我们通常会专门拿出一组（3+）主机来做管理Cluster，并将Edge Cluster部署在此。</p><p><img src="https://img-blog.csdnimg.cn/20210516194252498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516194252498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>这一步比较关键，将在这里指定两台N-VDS的配置，Overlay的交换机和主机准备的Overlay在同意个Transport Zone。</p><p><img src="https://img-blog.csdnimg.cn/20210516194554598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516194554598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>注意：Uplink口连接到VDS的Overlay-Port-Group上面。
然后，我们还要建一个虚拟交换机：
Transport Zone使用VLAN属性的tz-vlan，上联到VDS的Vlan-01-Port-Group</p><p><img src="https://img-blog.csdnimg.cn/20210516194737917.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516194737917.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>点击完成，系统会自动生成VM Edge实例。</p><p><img src="https://img-blog.csdnimg.cn/20210516200654249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516200654249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p><img src="https://img-blog.csdnimg.cn/20210516200729941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516200729941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p>从vCenter也可以看到edge部署好了。接下来，我们再部署一个vm Edge并建立Cluster</p><p><img src="https://img-blog.csdnimg.cn/20210516203452977.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20210516203452977.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70"></p><p><img src=https://img-blog.csdnimg.cn/20210516203504216.png alt=https://img-blog.csdnimg.cn/20210516203504216.png></p><p>部署完成的整体架构如下图：</p><p><img src="https://img-blog.csdnimg.cn/20210516203708328.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/20210516203708328.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM5NDcyNA==,size_16,color_FFFFFF,t_70#pic_center"></p><p>在此基础上，我们就可以进行路由和交换等方面的部署了。</p><p>小结：
我们在讲NSX-T架构的时候，一般会涉及两个层次：</p><ol><li>管控分离的架构：Manager、Controller和主机数据平面</li><li>实际部署的N-VDS、Edge架构</li></ol></div><footer class=post-footer><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview>站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/img/avatar.png alt=Etaon><p class=site-author-name itemprop=name>Etaon</p><p class="site-description motion-element" itemprop=description>Kepp Going!</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>64</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>14</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>35</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/etaon target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span>
<span class=links-of-author-item><a href=https://blog.csdn.net/weixin_43394724 target=_blank title=CSDN><i class="fa fa-fw fa-CSDN"></i>
CSDN</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class=links-of-blogroll-title><i class="fa fa-fw fa-globe"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://kubernetes.io/ title=Kubernetes target=_blank>Kubernetes</a></li><li class=links-of-blogroll-item><a href=https://cisco.com/ title=Cisco target=_blank>Cisco</a></li><li class=links-of-blogroll-item><a href=https://www.w3school.com.cn/ title=W3School target=_blank>W3School</a></li><li class=links-of-blogroll-item><a href=https://www.liaoxuefeng.com/ title=廖雪峰 target=_blank>廖雪峰</a></li></ul></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>
标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/mysql>Mysql</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/aws>Aws</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/dql>Dql</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/hadoop>Hadoop</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/redis>Redis</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/cicd>Cicd</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/git>Git</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/istio>Istio</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/mongodb>Mongodb</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/azure>Azure</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#查看manager实例>查看Manager实例</a></li><li><a href=#云网解耦物理网>云网解耦物理网</a></li><li><a href=#配置transport-zones>配置Transport Zones</a></li><li><a href=#绑定vcenter>绑定vCenter</a></li><li><a href=#主机准备>主机准备</a></li><li><a href=#为vtep建ip-pool>为VTEP建IP Pool</a></li><li><a href=#利用计算集群做主机准备>利用计算集群做主机准备</a></li></ul></li><li><a href=#检查主机准备>检查主机准备</a><ul><li><a href=#vib信息>VIB信息</a></li><li><a href=#geneve-状态>GENEVE 状态</a></li></ul></li><li><a href=#传输节点-edge>传输节点-Edge</a><ul><li><a href=#逻辑路由器>逻辑路由器</a></li><li><a href=#逻辑路由器和edge的关系>逻辑路由器和Edge的关系</a></li><li><a href=#edge类型>Edge类型</a></li><li><a href=#部署vm-edge>部署VM Edge</a></li></ul></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2010 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>路无止境！</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.101.0</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span class=site-uv><i class="fa fa-user"></i>
<span class=busuanzi-value id=busuanzi_value_site_uv></span></span>
<span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i>
<span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div><div class=license-info><span class=storage-info>Storage by
<a href=https://www.azure.com/ style=font-weight:700 target=_blank>Azure static web apps</a></span>
<span class=separator-line>/</span>
<span class=license-num><a href target=_blank></a></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=/js/search.js></script>
<script type=text/javascript src=/js/affix.js></script>
<script type=text/javascript src=/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){var t=$("#content").height(),e=$(window).height(),n=t>e?t-e:$(document).height()-e;return n}function getScrollbarWidth(){var e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){var t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);var s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){var t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){var e=$(".header-inner").height(),t=parseInt($(".main").css("padding-bottom"),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}}),$(document).on("affixed.bs.affix",function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){var e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);var e,t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){var e,t,n,s,o=$(".header-inner").height()+10;$("#sidebar").css({"margin-top":o}).show(),t=parseInt($("#sidebar").css("margin-top")),n=parseInt($(".sidebar-inner").css("height")),e=t+n,s=$(".content-wrap").height(),s<e&&$(".content-wrap").css("min-height",e),$(".site-nav-toggle").on("click",function(){var e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script><script type=text/javascript>$(function(){detectIE()>0?$.getScript(document.location.protocol+"//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js",function(){new Waline({el:"#wcomments",visitor:!0,avatar:"wavatar",avatarCDN:"https://sdn.geekzu.org/avatar/",avatarForce:!1,wordLimit:"200",placeholder:" 欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^ ",requiredFields:["nick","mail"],serverURL:"Your WalineSerURL",lang:"zh-cn"})}):$("#wcomments").html("抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。")})</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script>
<script>(function(){var t,e=document.createElement("script"),n=window.location.protocol.split(":")[0];n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>